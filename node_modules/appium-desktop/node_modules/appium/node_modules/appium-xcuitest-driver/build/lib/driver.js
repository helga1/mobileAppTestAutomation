"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.XCUITestDriver = exports.default = void 0;

require("source-map-support/register");

var _appiumBaseDriver = require("appium-base-driver");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _url = _interopRequireDefault(require("url"));

var _nodeSimctl = require("node-simctl");

var _webdriveragent = _interopRequireDefault(require("./wda/webdriveragent"));

var _logger = _interopRequireDefault(require("./logger"));

var _simulatorManagement = require("./simulator-management");

var _appiumIosSimulator = require("appium-ios-simulator");

var _asyncbox = require("asyncbox");

var _appiumIosDriver = require("appium-ios-driver");

var _desiredCaps = require("./desired-caps");

var _index = _interopRequireDefault(require("./commands/index"));

var _utils = require("./utils");

var _realDeviceManagement = require("./real-device-management");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _path = _interopRequireDefault(require("path"));

var _child_process = require("child_process");

var _appiumIdb = _interopRequireDefault(require("appium-idb"));

const SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
const WDA_SIM_STARTUP_RETRIES = 2;
const WDA_REAL_DEV_STARTUP_RETRIES = 1;
const WDA_REAL_DEV_TUTORIAL_URL = 'https://github.com/appium/appium-xcuitest-driver/blob/master/docs/real-device-config.md';
const WDA_STARTUP_RETRY_INTERVAL = 10000;
const DEFAULT_SETTINGS = {
  nativeWebTap: false,
  useJSONSource: false,
  shouldUseCompactResponses: true,
  elementResponseAttributes: 'type,label',
  mjpegServerScreenshotQuality: 25,
  mjpegServerFramerate: 10,
  screenshotQuality: 1,
  mjpegScalingFactor: 100
};
const SHARED_RESOURCES_GUARD = new _asyncLock.default();
const NO_PROXY_NATIVE_LIST = [['DELETE', /window/], ['GET', /^\/session\/[^\/]+$/], ['GET', /alert_text/], ['GET', /alert\/[^\/]+/], ['GET', /appium/], ['GET', /attribute/], ['GET', /context/], ['GET', /location/], ['GET', /log/], ['GET', /screenshot/], ['GET', /size/], ['GET', /source/], ['GET', /url/], ['GET', /window/], ['POST', /accept_alert/], ['POST', /actions$/], ['POST', /alert_text/], ['POST', /alert\/[^\/]+/], ['POST', /appium/], ['POST', /appium\/device\/is_locked/], ['POST', /appium\/device\/lock/], ['POST', /appium\/device\/unlock/], ['POST', /back/], ['POST', /clear/], ['POST', /context/], ['POST', /dismiss_alert/], ['POST', /element$/], ['POST', /elements$/], ['POST', /execute/], ['POST', /keys/], ['POST', /log/], ['POST', /moveto/], ['POST', /receive_async_response/], ['POST', /session\/[^\/]+\/location/], ['POST', /shake/], ['POST', /timeouts/], ['POST', /touch/], ['POST', /url/], ['POST', /value/], ['POST', /window/]];
const NO_PROXY_WEB_LIST = [['DELETE', /cookie/], ['GET', /attribute/], ['GET', /cookie/], ['GET', /element/], ['GET', /text/], ['GET', /title/], ['POST', /clear/], ['POST', /click/], ['POST', /cookie/], ['POST', /element/], ['POST', /forward/], ['POST', /frame/], ['POST', /keys/], ['POST', /refresh/]].concat(NO_PROXY_NATIVE_LIST);
const MEMOIZED_FUNCTIONS = ['getStatusBarHeight', 'getDevicePixelRatio', 'getScreenInfo', 'getSafariIsIphone', 'getSafariIsIphoneX'];

class XCUITestDriver extends _appiumBaseDriver.BaseDriver {
  constructor(opts = {}, shouldValidateCaps = true) {
    super(opts, shouldValidateCaps);
    this.desiredCapConstraints = _desiredCaps.desiredCapConstraints;
    this.locatorStrategies = ['xpath', 'id', 'name', 'class name', '-ios predicate string', '-ios class chain', 'accessibility id'];
    this.webLocatorStrategies = ['link text', 'css selector', 'tag name', 'link text', 'partial link text'];
    this.resetIos();
    this.settings = new _appiumBaseDriver.DeviceSettings(DEFAULT_SETTINGS, this.onSettingsUpdate.bind(this));
    this.logs = {};

    for (const fn of MEMOIZED_FUNCTIONS) {
      this[fn] = _lodash.default.memoize(this[fn]);
    }
  }

  async onSettingsUpdate(key, value) {
    if (key !== 'nativeWebTap') {
      return await this.proxyCommand('/appium/settings', 'POST', {
        settings: {
          [key]: value
        }
      });
    }

    this.opts.nativeWebTap = !!value;
  }

  resetIos() {
    this.opts = this.opts || {};
    this.wda = null;
    this.opts.device = null;
    this.jwpProxyActive = false;
    this.proxyReqRes = null;
    this.jwpProxyAvoid = [];
    this.safari = false;
    this.cachedWdaStatus = null;
    this.curWebFrames = [];
    this.webElementIds = [];
    this._currentUrl = null;
    this.curContext = null;
    this.xcodeVersion = {};
    this.contexts = [];
    this.implicitWaitMs = 0;
    this.asynclibWaitMs = 0;
    this.pageLoadMs = 6000;
    this.landscapeWebCoordsOffset = 0;
  }

  get driverData() {
    return {};
  }

  async getStatus() {
    if (typeof this.driverInfo === 'undefined') {
      this.driverInfo = await (0, _utils.getDriverInfo)();
    }

    let status = {
      build: {
        version: this.driverInfo.version
      }
    };

    if (this.cachedWdaStatus) {
      status.wda = this.cachedWdaStatus;
    }

    return status;
  }

  async createSession(...args) {
    this.lifecycleData = {};

    try {
      let [sessionId, caps] = await super.createSession(...args);
      this.opts.sessionId = sessionId;
      await this.start();
      caps = Object.assign({}, _appiumIosDriver.defaultServerCaps, caps);
      caps.udid = this.opts.udid;

      if (_lodash.default.has(this.opts, 'nativeWebTap')) {
        await this.updateSettings({
          nativeWebTap: this.opts.nativeWebTap
        });
      }

      if (_lodash.default.has(this.opts, 'useJSONSource')) {
        await this.updateSettings({
          useJSONSource: this.opts.useJSONSource
        });
      }

      let wdaSettings = {
        elementResponseAttributes: DEFAULT_SETTINGS.elementResponseAttributes,
        shouldUseCompactResponses: DEFAULT_SETTINGS.shouldUseCompactResponses
      };

      if (_lodash.default.has(this.opts, 'elementResponseAttributes')) {
        wdaSettings.elementResponseAttributes = this.opts.elementResponseAttributes;
      }

      if (_lodash.default.has(this.opts, 'shouldUseCompactResponses')) {
        wdaSettings.shouldUseCompactResponses = this.opts.shouldUseCompactResponses;
      }

      if (_lodash.default.has(this.opts, 'mjpegServerScreenshotQuality')) {
        wdaSettings.mjpegServerScreenshotQuality = this.opts.mjpegServerScreenshotQuality;
      }

      if (_lodash.default.has(this.opts, 'mjpegServerFramerate')) {
        wdaSettings.mjpegServerFramerate = this.opts.mjpegServerFramerate;
      }

      if (_lodash.default.has(this.opts, 'screenshotQuality')) {
        _logger.default.info(`Setting the quality of phone screenshot: '${this.opts.screenshotQuality}'`);

        wdaSettings.screenshotQuality = this.opts.screenshotQuality;
      }

      await this.updateSettings(wdaSettings);

      if (this.opts.mjpegScreenshotUrl) {
        _logger.default.info(`Starting MJPEG stream reading URL: '${this.opts.mjpegScreenshotUrl}'`);

        this.mjpegStream = new _appiumSupport.mjpeg.MJpegStream(this.opts.mjpegScreenshotUrl);
        await this.mjpegStream.start();
      }

      return [sessionId, caps];
    } catch (e) {
      _logger.default.error(e);

      await this.deleteSession();
      throw e;
    }
  }

  async start() {
    this.opts.noReset = !!this.opts.noReset;
    this.opts.fullReset = !!this.opts.fullReset;
    await (0, _utils.printUser)();
    this.opts.iosSdkVersion = null;
    const {
      device,
      udid,
      realDevice
    } = await this.determineDevice();

    _logger.default.info(`Determining device to run tests on: udid: '${udid}', real device: ${realDevice}`);

    this.opts.device = device;
    this.opts.udid = udid;
    this.opts.realDevice = realDevice;
    const normalizedVersion = (0, _utils.normalizePlatformVersion)(this.opts.platformVersion);

    if (this.opts.platformVersion !== normalizedVersion) {
      _logger.default.info(`Normalized platformVersion capability value '${this.opts.platformVersion}' to '${normalizedVersion}'`);

      this.opts.platformVersion = normalizedVersion;
    }

    if (_appiumSupport.util.compareVersions(this.opts.platformVersion, '<', '9.3')) {
      throw new Error(`Platform version must be 9.3 or above. '${this.opts.platformVersion}' is not supported.`);
    }

    if (_lodash.default.isEmpty(this.xcodeVersion) && (!this.opts.webDriverAgentUrl || !this.opts.realDevice)) {
      this.xcodeVersion = await (0, _utils.getAndCheckXcodeVersion)();
    }

    this.logEvent('xcodeDetailsRetrieved');

    if (this.opts.enableAsyncExecuteFromHttps && !this.isRealDevice()) {
      await (0, _simulatorManagement.shutdownSimulator)(this.opts.device);
      await this.startHttpsAsyncServer();
    }

    if (!this.opts.platformVersion) {
      if (this.opts.device && _lodash.default.isFunction(this.opts.device.getPlatformVersion)) {
        this.opts.platformVersion = await this.opts.device.getPlatformVersion();

        _logger.default.info(`No platformVersion specified. Using device version: '${this.opts.platformVersion}'`);
      } else {}
    }

    if ((this.opts.browserName || '').toLowerCase() === 'safari') {
      _logger.default.info('Safari test requested');

      this.safari = true;
      this.opts.app = undefined;
      this.opts.processArguments = this.opts.processArguments || {};
      this.opts.bundleId = SAFARI_BUNDLE_ID;
      this._currentUrl = this.opts.safariInitialUrl || (this.isRealDevice() ? 'http://appium.io' : `http://${this.opts.address}:${this.opts.port}/welcome`);

      if (_appiumSupport.util.compareVersions(this.opts.platformVersion, '<', '12.2')) {
        this.opts.processArguments.args = ['-u', this._currentUrl];
      }
    } else {
      await this.configureApp();
    }

    this.logEvent('appConfigured');

    if (this.opts.app) {
      await (0, _utils.checkAppPresent)(this.opts.app);
    }

    if (!this.opts.bundleId) {
      this.opts.bundleId = await _appiumIosDriver.appUtils.extractBundleId(this.opts.app);
    }

    await this.runReset();

    const memoizedLogInfo = _lodash.default.memoize(function logInfo() {
      _logger.default.info("'skipLogCapture' is set. Skipping starting logs such as crash, system, safari console and safari network.");
    });

    const startLogCapture = async () => {
      if (this.opts.skipLogCapture) {
        memoizedLogInfo();
        return false;
      }

      const result = await this.startLogCapture();

      if (result) {
        this.logEvent('logCaptureStarted');
      }

      return result;
    };

    const isLogCaptureStarted = await startLogCapture();

    _logger.default.info(`Setting up ${this.isRealDevice() ? 'real device' : 'simulator'}`);

    if (this.isSimulator()) {
      if (this.opts.shutdownOtherSimulators) {
        if (!this.relaxedSecurityEnabled) {
          _logger.default.errorAndThrow(`Appium server must have relaxed security flag set in order ` + `for 'shutdownOtherSimulators' capability to work`);
        }

        await (0, _simulatorManagement.shutdownOtherSimulators)(this.opts.device);
      }

      if (_appiumSupport.util.hasValue(this.opts.reduceMotion)) {
        await this.opts.device.setReduceMotion(this.opts.reduceMotion);
      }

      this.localConfig = await _appiumIosDriver.settings.setLocaleAndPreferences(this.opts.device, this.opts, this.isSafari(), async sim => {
        await (0, _simulatorManagement.shutdownSimulator)(sim);
        await _appiumIosDriver.settings.setLocaleAndPreferences(sim, this.opts, this.isSafari());
      });
      await this.startSim();

      if (this.opts.customSSLCert) {
        if (await (0, _appiumIosSimulator.hasSSLCert)(this.opts.customSSLCert, this.opts.udid)) {
          _logger.default.info(`SSL cert '${_lodash.default.truncate(this.opts.customSSLCert, {
            length: 20
          })}' already installed`);
        } else {
          _logger.default.info(`Installing ssl cert '${_lodash.default.truncate(this.opts.customSSLCert, {
            length: 20
          })}'`);

          await (0, _simulatorManagement.shutdownSimulator)(this.opts.device);
          await (0, _appiumIosSimulator.installSSLCert)(this.opts.customSSLCert, this.opts.udid);

          _logger.default.info(`Restarting Simulator so that SSL certificate installation takes effect`);

          await this.startSim();
          this.logEvent('customCertInstalled');
        }
      }

      try {
        const idb = new _appiumIdb.default({
          udid
        });
        await idb.connect();
        this.opts.device.idb = idb;
      } catch (e) {
        _logger.default.info(`idb will not be used for Simulator interaction. Original error: ${e.message}`);
      }

      this.logEvent('simStarted');

      if (!isLogCaptureStarted) {
        await startLogCapture();
      }
    }

    if (this.opts.app) {
      await this.installAUT();
      this.logEvent('appInstalled');
    }

    if (!this.opts.app && this.opts.bundleId && !this.safari) {
      if (!(await this.opts.device.isAppInstalled(this.opts.bundleId))) {
        _logger.default.errorAndThrow(`App with bundle identifier '${this.opts.bundleId}' unknown`);
      }
    }

    if (this.opts.permissions) {
      if (this.isSimulator()) {
        _logger.default.debug('Setting the requested permissions before WDA is started');

        for (const [bundleId, permissionsMapping] of _lodash.default.toPairs(JSON.parse(this.opts.permissions))) {
          await this.opts.device.setPermissions(bundleId, permissionsMapping);
        }
      } else {
        _logger.default.warn('Setting permissions is only supported on Simulator. ' + 'The "permissions" capability will be ignored.');
      }
    }

    await this.startWda(this.opts.sessionId, realDevice);
    await this.setInitialOrientation(this.opts.orientation);
    this.logEvent('orientationSet');

    if (this.isSafari() && !this.isRealDevice() && _appiumSupport.util.compareVersions(this.opts.platformVersion, '>=', '12.2')) {
      await (0, _nodeSimctl.openUrl)(this.opts.device.udid, this._currentUrl);
    }

    if (this.isRealDevice() && this.opts.startIWDP) {
      try {
        await this.startIWDP();

        _logger.default.debug(`Started ios_webkit_debug proxy server at: ${this.iwdpServer.endpoint}`);
      } catch (err) {
        _logger.default.errorAndThrow(`Could not start ios_webkit_debug_proxy server: ${err.message}`);
      }
    }

    if (this.isSafari() || this.opts.autoWebview) {
      _logger.default.debug('Waiting for initial webview');

      await this.navToInitialWebview();
      this.logEvent('initialWebviewNavigated');
    }

    if (this.isSafari() && this.isRealDevice() && _appiumSupport.util.compareVersions(this.opts.platformVersion, '>=', '12.2')) {
      await this.setUrl(this._currentUrl);
    }

    if (!this.isRealDevice()) {
      if (this.opts.calendarAccessAuthorized) {
        await this.opts.device.enableCalendarAccess(this.opts.bundleId);
      } else if (this.opts.calendarAccessAuthorized === false) {
        await this.opts.device.disableCalendarAccess(this.opts.bundleId);
      }
    }
  }

  async startWda(sessionId, realDevice) {
    this.wda = new _webdriveragent.default(this.xcodeVersion, this.opts);

    if (!_appiumSupport.util.hasValue(this.wda.webDriverAgentUrl)) {
      await this.wda.cleanupObsoleteProcesses();
    }

    const synchronizationKey = !this.opts.useXctestrunFile && (await this.wda.isSourceFresh()) ? XCUITestDriver.name : _path.default.normalize((await this.wda.retrieveDerivedDataPath()));

    _logger.default.debug(`Starting WebDriverAgent initialization with the synchronization key '${synchronizationKey}'`);

    if (SHARED_RESOURCES_GUARD.isBusy() && !this.opts.derivedDataPath && !this.opts.bootstrapPath) {
      _logger.default.debug(`Consider setting a unique 'derivedDataPath' capability value for each parallel driver instance ` + `to avoid conflicts and speed up the building process`);
    }

    return await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {
      if (this.opts.useNewWDA) {
        _logger.default.debug(`Capability 'useNewWDA' set to true, so uninstalling WDA before proceeding`);

        await this.wda.quitAndUninstall();
        this.logEvent('wdaUninstalled');
      } else if (!_appiumSupport.util.hasValue(this.wda.webDriverAgentUrl)) {
        await this.wda.setupCaching(this.opts.updatedWDABundleId);
      }

      const quitAndUninstall = async msg => {
        _logger.default.debug(msg);

        if (this.opts.webDriverAgentUrl) {
          _logger.default.debug('Not quitting/uninstalling WebDriverAgent since webDriverAgentUrl capability is provided');

          throw new Error(msg);
        }

        _logger.default.warn('Quitting and uninstalling WebDriverAgent');

        await this.wda.quitAndUninstall();
        throw new Error(msg);
      };

      const startupRetries = this.opts.wdaStartupRetries || (this.isRealDevice() ? WDA_REAL_DEV_STARTUP_RETRIES : WDA_SIM_STARTUP_RETRIES);
      const startupRetryInterval = this.opts.wdaStartupRetryInterval || WDA_STARTUP_RETRY_INTERVAL;

      _logger.default.debug(`Trying to start WebDriverAgent ${startupRetries} times with ${startupRetryInterval}ms interval`);

      if (!_appiumSupport.util.hasValue(this.opts.wdaStartupRetries) && !_appiumSupport.util.hasValue(this.opts.wdaStartupRetryInterval)) {
        _logger.default.debug(`These values can be customized by changing wdaStartupRetries/wdaStartupRetryInterval capabilities`);
      }

      let retryCount = 0;
      await (0, _asyncbox.retryInterval)(startupRetries, startupRetryInterval, async () => {
        this.logEvent('wdaStartAttempted');

        if (retryCount > 0) {
          _logger.default.info(`Retrying WDA startup (${retryCount + 1} of ${startupRetries})`);
        }

        try {
          const retries = this.xcodeVersion.major >= 10 ? 2 : 1;
          this.cachedWdaStatus = await (0, _asyncbox.retry)(retries, this.wda.launch.bind(this.wda), sessionId, realDevice);
        } catch (err) {
          this.logEvent('wdaStartFailed');
          retryCount++;
          let errorMsg = `Unable to launch WebDriverAgent because of xcodebuild failure: ${err.message}`;

          if (this.isRealDevice()) {
            errorMsg += `. Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` + `Try to remove the WebDriverAgentRunner application from the device if it is installed ` + `and reboot the device.`;
          }

          await quitAndUninstall(errorMsg);
        }

        this.proxyReqRes = this.wda.proxyReqRes.bind(this.wda);
        this.jwpProxyActive = true;
        let originalStacktrace = null;

        try {
          await (0, _asyncbox.retryInterval)(15, 1000, async () => {
            this.logEvent('wdaSessionAttempted');

            _logger.default.debug('Sending createSession command to WDA');

            try {
              this.cachedWdaStatus = this.cachedWdaStatus || (await this.proxyCommand('/status', 'GET'));
              await this.startWdaSession(this.opts.bundleId, this.opts.processArguments);
            } catch (err) {
              originalStacktrace = err.stack;

              _logger.default.debug(`Failed to create WDA session (${err.message}). Retrying...`);

              throw err;
            }
          });
          this.logEvent('wdaSessionStarted');
        } catch (err) {
          if (originalStacktrace) {
            _logger.default.debug(originalStacktrace);
          }

          let errorMsg = `Unable to start WebDriverAgent session because of xcodebuild failure: ${err.message}`;

          if (this.isRealDevice()) {
            errorMsg += ` Make sure you follow the tutorial at ${WDA_REAL_DEV_TUTORIAL_URL}. ` + `Try to remove the WebDriverAgentRunner application from the device if it is installed ` + `and reboot the device.`;
          }

          await quitAndUninstall(errorMsg);
        }

        if (this.opts.clearSystemFiles && !this.opts.webDriverAgentUrl) {
          await (0, _utils.markSystemFilesForCleanup)(this.wda);
        }

        this.wda.fullyStarted = true;
        this.logEvent('wdaStarted');
      });
    });
  }

  async runReset(opts = null) {
    this.logEvent('resetStarted');

    if (this.isRealDevice()) {
      await (0, _realDeviceManagement.runRealDeviceReset)(this.opts.device, opts || this.opts);
    } else {
      await (0, _simulatorManagement.runSimulatorReset)(this.opts.device, opts || this.opts);
    }

    this.logEvent('resetComplete');
  }

  async deleteSession() {
    await (0, _utils.removeAllSessionWebSocketHandlers)(this.server, this.sessionId);

    if (this.isSimulator() && (this.opts.device || {}).idb) {
      await this.opts.device.idb.disconnect();
      this.opts.device.idb = null;
    }

    await this.stop();

    if (this.opts.clearSystemFiles && this.isAppTemporary) {
      await _appiumSupport.fs.rimraf(this.opts.app);
    }

    if (this.wda && !this.opts.webDriverAgentUrl) {
      const synchronizationKey = _path.default.normalize((await this.wda.retrieveDerivedDataPath()));

      await SHARED_RESOURCES_GUARD.acquire(synchronizationKey, async () => {
        if (this.opts.clearSystemFiles) {
          await (0, _utils.clearSystemFiles)(this.wda);
        } else {
          _logger.default.debug('Not clearing log files. Use `clearSystemFiles` capability to turn on.');
        }
      });
    }

    if (this.isWebContext()) {
      _logger.default.debug('In a web session. Removing remote debugger');

      await this.stopRemote();
    }

    if (this.opts.resetOnSessionStartOnly === false) {
      await this.runReset(Object.assign({}, this.opts, {
        enforceSimulatorShutdown: true
      }));
    }

    if (this.isSimulator() && !this.opts.noReset && !!this.opts.device) {
      if (this.lifecycleData.createSim) {
        _logger.default.debug(`Deleting simulator created for this run (udid: '${this.opts.udid}')`);

        await (0, _simulatorManagement.shutdownSimulator)(this.opts.device);
        await this.opts.device.delete();
      }
    }

    if (!_lodash.default.isEmpty(this.logs)) {
      await this.logs.syslog.stopCapture();
      this.logs = {};
    }

    if (this.iwdpServer) {
      await this.stopIWDP();
    }

    if (this.opts.enableAsyncExecuteFromHttps && !this.isRealDevice()) {
      await this.stopHttpsAsyncServer();
    }

    if (this.mjpegStream) {
      _logger.default.info('Closing MJPEG stream');

      this.mjpegStream.stop();
    }

    this.resetIos();
    await super.deleteSession();
  }

  async stop() {
    this.jwpProxyActive = false;
    this.proxyReqRes = null;

    if (this.wda && this.wda.fullyStarted) {
      if (this.wda.jwproxy) {
        try {
          await this.proxyCommand(`/session/${this.sessionId}`, 'DELETE');
        } catch (err) {
          _logger.default.debug(`Unable to DELETE session on WDA: '${err.message}'. Continuing shutdown.`);
        }
      }

      if (this.wda && !this.wda.webDriverAgentUrl && this.opts.useNewWDA) {
        await this.wda.quit();
      }
    }
  }

  async executeCommand(cmd, ...args) {
    _logger.default.debug(`Executing command '${cmd}'`);

    if (cmd === 'receiveAsyncResponse') {
      return await this.receiveAsyncResponse(...args);
    }

    if (cmd === 'getStatus') {
      return await this.getStatus();
    }

    return await super.executeCommand(cmd, ...args);
  }

  async configureApp() {
    function appIsPackageOrBundle(app) {
      return /^([a-zA-Z0-9\-_]+\.[a-zA-Z0-9\-_]+)+$/.test(app);
    }

    if (!this.opts.bundleId && appIsPackageOrBundle(this.opts.app)) {
      this.opts.bundleId = this.opts.app;
      this.opts.app = '';
    }

    if (this.opts.bundleId && appIsPackageOrBundle(this.opts.bundleId) && (this.opts.app === '' || appIsPackageOrBundle(this.opts.app))) {
      _logger.default.debug('App is an iOS bundle, will attempt to run as pre-existing');

      return;
    }

    if (this.opts.app && this.opts.app.toLowerCase() === 'settings') {
      this.opts.bundleId = 'com.apple.Preferences';
      this.opts.app = null;
      return;
    } else if (this.opts.app && this.opts.app.toLowerCase() === 'calendar') {
      this.opts.bundleId = 'com.apple.mobilecal';
      this.opts.app = null;
      return;
    }

    const originalAppPath = this.opts.app;

    try {
      this.opts.app = await this.helpers.configureApp(this.opts.app, '.app');
    } catch (err) {
      _logger.default.error(err);

      throw new Error(`Bad app: ${this.opts.app}. App paths need to be absolute or an URL to a compressed app file${err && err.message ? `: ${err.message}` : ''}`);
    }

    this.isAppTemporary = this.opts.app && (await _appiumSupport.fs.exists(this.opts.app)) && !(await _appiumSupport.util.isSameDestination(originalAppPath, this.opts.app));
  }

  async determineDevice() {
    this.lifecycleData.createSim = false;
    this.opts.deviceName = (0, _utils.translateDeviceName)(this.opts.platformVersion, this.opts.deviceName);

    const setupVersionCaps = async () => {
      this.opts.iosSdkVersion = await (0, _utils.getAndCheckIosSdkVersion)();

      _logger.default.info(`iOS SDK Version set to '${this.opts.iosSdkVersion}'`);

      if (!this.opts.platformVersion && this.opts.iosSdkVersion) {
        _logger.default.info(`No platformVersion specified. Using the latest version Xcode supports: '${this.opts.iosSdkVersion}'. ` + `This may cause problems if a simulator does not exist for this platform version.`);

        this.opts.platformVersion = (0, _utils.normalizePlatformVersion)(this.opts.iosSdkVersion);
      }
    };

    if (this.opts.udid) {
      if (this.opts.udid.toLowerCase() === 'auto') {
        try {
          this.opts.udid = await (0, _utils.detectUdid)();
        } catch (err) {
          _logger.default.warn(`Cannot detect any connected real devices. Falling back to Simulator. Original error: ${err.message}`);

          const device = await (0, _simulatorManagement.getExistingSim)(this.opts);

          if (!device) {
            _logger.default.errorAndThrow(`Cannot detect udid for ${this.opts.deviceName} Simulator running iOS ${this.opts.platformVersion}`);
          }

          this.opts.udid = device.udid;
          const devicePlatform = (0, _utils.normalizePlatformVersion)((await device.getPlatformVersion()));

          if (this.opts.platformVersion !== devicePlatform) {
            this.opts.platformVersion = devicePlatform;

            _logger.default.info(`Set platformVersion to '${devicePlatform}' to match the device with given UDID`);
          }

          await setupVersionCaps();
          return {
            device,
            realDevice: false,
            udid: device.udid
          };
        }
      } else {
        const devices = await (0, _realDeviceManagement.getConnectedDevices)();

        _logger.default.debug(`Available devices: ${devices.join(', ')}`);

        if (!devices.includes(this.opts.udid)) {
          if (await (0, _appiumIosSimulator.simExists)(this.opts.udid)) {
            const device = await (0, _appiumIosSimulator.getSimulator)(this.opts.udid);
            return {
              device,
              realDevice: false,
              udid: this.opts.udid
            };
          }

          throw new Error(`Unknown device or simulator UDID: '${this.opts.udid}'`);
        }
      }

      const device = await (0, _realDeviceManagement.getRealDeviceObj)(this.opts.udid);

      if (_lodash.default.isEmpty(this.opts.platformVersion)) {
        _logger.default.info('Trying to determine platformVersion from ideviceinfo output');

        try {
          const {
            stdout
          } = await (0, _child_process.exec)('ideviceinfo', ['-u', this.opts.udid, '-s', '-k', 'ProductVersion']);
          this.opts.platformVersion = _appiumSupport.util.coerceVersion(stdout.trim(), false);
        } catch (e) {
          _logger.default.warn(`Cannot determine real device platform version. Original error: ${e.message}`);
        }
      }

      return {
        device,
        realDevice: true,
        udid: this.opts.udid
      };
    }

    await setupVersionCaps();

    if (this.opts.enforceFreshSimulatorCreation) {
      _logger.default.debug(`New simulator is requested. If this is not wanted, set 'enforceFreshSimulatorCreation' capability to false`);
    } else {
      const device = await (0, _simulatorManagement.getExistingSim)(this.opts);

      if (device) {
        return {
          device,
          realDevice: false,
          udid: device.udid
        };
      }

      _logger.default.info('Simulator udid not provided');
    }

    _logger.default.info('Using desired caps to create a new simulator');

    const device = await this.createSim();
    return {
      device,
      realDevice: false,
      udid: device.udid
    };
  }

  async startSim() {
    const runOpts = {
      scaleFactor: this.opts.scaleFactor,
      connectHardwareKeyboard: !!this.opts.connectHardwareKeyboard,
      isHeadless: !!this.opts.isHeadless,
      devicePreferences: {}
    };

    if (this.opts.SimulatorWindowCenter) {
      runOpts.devicePreferences.SimulatorWindowCenter = this.opts.SimulatorWindowCenter;
    }

    const orientation = _lodash.default.isString(this.opts.orientation) && this.opts.orientation.toUpperCase();

    switch (orientation) {
      case 'LANDSCAPE':
        runOpts.devicePreferences.SimulatorWindowOrientation = 'LandscapeLeft';
        runOpts.devicePreferences.SimulatorWindowRotationAngle = 90;
        break;

      case 'PORTRAIT':
        runOpts.devicePreferences.SimulatorWindowOrientation = 'Portrait';
        runOpts.devicePreferences.SimulatorWindowRotationAngle = 0;
        break;
    }

    await this.opts.device.run(runOpts);
  }

  async createSim() {
    this.lifecycleData.createSim = true;
    const platformName = (0, _utils.isTvOS)(this.opts.platformName) ? _desiredCaps.PLATFORM_NAME_TVOS : _desiredCaps.PLATFORM_NAME_IOS;
    let sim = await (0, _simulatorManagement.createSim)(this.opts, platformName);

    _logger.default.info(`Created simulator with udid '${sim.udid}'.`);

    return sim;
  }

  async launchApp() {
    const APP_LAUNCH_TIMEOUT = 20 * 1000;
    this.logEvent('appLaunchAttempted');
    await (0, _nodeSimctl.launch)(this.opts.device.udid, this.opts.bundleId);

    let checkStatus = async () => {
      let response = await this.proxyCommand('/status', 'GET');
      let currentApp = response.currentApp.bundleID;

      if (currentApp !== this.opts.bundleId) {
        throw new Error(`${this.opts.bundleId} not in foreground. ${currentApp} is in foreground`);
      }
    };

    _logger.default.info(`Waiting for '${this.opts.bundleId}' to be in foreground`);

    let retries = parseInt(APP_LAUNCH_TIMEOUT / 200, 10);
    await (0, _asyncbox.retryInterval)(retries, 200, checkStatus);

    _logger.default.info(`${this.opts.bundleId} is in foreground`);

    this.logEvent('appLaunched');
  }

  async startWdaSession(bundleId, processArguments) {
    let args = processArguments ? processArguments.args || [] : [];

    if (!_lodash.default.isArray(args)) {
      throw new Error(`processArguments.args capability is expected to be an array. ` + `${JSON.stringify(args)} is given instead`);
    }

    let env = processArguments ? processArguments.env || {} : {};

    if (!_lodash.default.isPlainObject(env)) {
      throw new Error(`processArguments.env capability is expected to be a dictionary. ` + `${JSON.stringify(env)} is given instead`);
    }

    let shouldWaitForQuiescence = _appiumSupport.util.hasValue(this.opts.waitForQuiescence) ? this.opts.waitForQuiescence : true;
    let maxTypingFrequency = _appiumSupport.util.hasValue(this.opts.maxTypingFrequency) ? this.opts.maxTypingFrequency : 60;
    let shouldUseSingletonTestManager = _appiumSupport.util.hasValue(this.opts.shouldUseSingletonTestManager) ? this.opts.shouldUseSingletonTestManager : true;
    let shouldUseTestManagerForVisibilityDetection = false;
    let eventloopIdleDelaySec = this.opts.wdaEventloopIdleDelay || 0;

    if (_appiumSupport.util.hasValue(this.opts.simpleIsVisibleCheck)) {
      shouldUseTestManagerForVisibilityDetection = this.opts.simpleIsVisibleCheck;
    }

    if (_appiumSupport.util.compareVersions(this.opts.platformVersion, '==', '9.3')) {
      _logger.default.info(`Forcing shouldUseSingletonTestManager capability value to true, because of known XCTest issues under 9.3 platform version`);

      shouldUseTestManagerForVisibilityDetection = true;
    }

    if (_appiumSupport.util.hasValue(this.opts.language)) {
      args.push('-AppleLanguages', `(${this.opts.language})`);
      args.push('-NSLanguages', `(${this.opts.language})`);
    }

    if (_appiumSupport.util.hasValue(this.opts.locale)) {
      args.push('-AppleLocale', this.opts.locale);
    }

    let desired = {
      desiredCapabilities: {
        bundleId,
        arguments: args,
        environment: env,
        eventloopIdleDelaySec,
        shouldWaitForQuiescence,
        shouldUseTestManagerForVisibilityDetection,
        maxTypingFrequency,
        shouldUseSingletonTestManager
      }
    };

    if (_appiumSupport.util.hasValue(this.opts.shouldUseCompactResponses)) {
      desired.desiredCapabilities.shouldUseCompactResponses = this.opts.shouldUseCompactResponses;
    }

    if (_appiumSupport.util.hasValue(this.opts.elementResponseFields)) {
      desired.desiredCapabilities.elementResponseFields = this.opts.elementResponseFields;
    }

    if (this.opts.autoAcceptAlerts) {
      desired.desiredCapabilities.defaultAlertAction = 'accept';
    } else if (this.opts.autoDismissAlerts) {
      desired.desiredCapabilities.defaultAlertAction = 'dismiss';
    }

    await this.proxyCommand('/session', 'POST', desired);
  }

  proxyActive() {
    return this.jwpProxyActive;
  }

  getProxyAvoidList() {
    if (this.isWebview()) {
      return NO_PROXY_WEB_LIST;
    }

    return NO_PROXY_NATIVE_LIST;
  }

  canProxy() {
    return true;
  }

  isSafari() {
    return !!this.safari;
  }

  isRealDevice() {
    return this.opts.realDevice;
  }

  isSimulator() {
    return !this.opts.realDevice;
  }

  isWebview() {
    return this.isSafari() || this.isWebContext();
  }

  validateLocatorStrategy(strategy) {
    super.validateLocatorStrategy(strategy, this.isWebContext());
  }

  validateDesiredCaps(caps) {
    if (!super.validateDesiredCaps(caps)) {
      return false;
    }

    if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
      let msg = 'The desired capabilities must include either an app or a bundleId for iOS';

      _logger.default.errorAndThrow(msg);
    }

    if (!_appiumSupport.util.coerceVersion(caps.platformVersion, false)) {
      _logger.default.warn(`'platformVersion' capability ('${caps.platformVersion}') is not a valid version number. ` + `Consider fixing it or be ready to experience an inconsistent driver behavior.`);
    }

    let verifyProcessArgument = processArguments => {
      const {
        args,
        env
      } = processArguments;

      if (!_lodash.default.isNil(args) && !_lodash.default.isArray(args)) {
        _logger.default.errorAndThrow('processArguments.args must be an array of strings');
      }

      if (!_lodash.default.isNil(env) && !_lodash.default.isPlainObject(env)) {
        _logger.default.errorAndThrow('processArguments.env must be an object <key,value> pair {a:b, c:d}');
      }
    };

    if (caps.processArguments) {
      if (_lodash.default.isString(caps.processArguments)) {
        try {
          caps.processArguments = JSON.parse(caps.processArguments);
          verifyProcessArgument(caps.processArguments);
        } catch (err) {
          _logger.default.errorAndThrow(`processArguments must be a json format or an object with format {args : [], env : {a:b, c:d}}. ` + `Both environment and argument can be null. Error: ${err}`);
        }
      } else if (_lodash.default.isPlainObject(caps.processArguments)) {
        verifyProcessArgument(caps.processArguments);
      } else {
        _logger.default.errorAndThrow(`'processArguments must be an object, or a string JSON object with format {args : [], env : {a:b, c:d}}. ` + `Both environment and argument can be null.`);
      }
    }

    if (caps.keychainPath && !caps.keychainPassword || !caps.keychainPath && caps.keychainPassword) {
      _logger.default.errorAndThrow(`If 'keychainPath' is set, 'keychainPassword' must also be set (and vice versa).`);
    }

    this.opts.resetOnSessionStartOnly = !_appiumSupport.util.hasValue(this.opts.resetOnSessionStartOnly) || this.opts.resetOnSessionStartOnly;
    this.opts.useNewWDA = _appiumSupport.util.hasValue(this.opts.useNewWDA) ? this.opts.useNewWDA : false;

    if (caps.commandTimeouts) {
      caps.commandTimeouts = (0, _utils.normalizeCommandTimeouts)(caps.commandTimeouts);
    }

    if (_lodash.default.isString(caps.webDriverAgentUrl)) {
      const {
        protocol,
        host
      } = _url.default.parse(caps.webDriverAgentUrl);

      if (_lodash.default.isEmpty(protocol) || _lodash.default.isEmpty(host)) {
        _logger.default.errorAndThrow(`'webDriverAgentUrl' capability is expected to contain a valid WebDriverAgent server URL. ` + `'${caps.webDriverAgentUrl}' is given instead`);
      }
    }

    if (caps.browserName) {
      if (caps.bundleId) {
        _logger.default.errorAndThrow(`'browserName' cannot be set together with 'bundleId' capability`);
      }

      if (caps.app) {
        _logger.default.warn(`The capabilities should generally not include both an 'app' and a 'browserName'`);
      }
    }

    if (caps.permissions) {
      try {
        for (const [bundleId, perms] of _lodash.default.toPairs(JSON.parse(caps.permissions))) {
          if (!_lodash.default.isString(bundleId)) {
            throw new Error(`'${JSON.stringify(bundleId)}' must be a string`);
          }

          if (!_lodash.default.isPlainObject(perms)) {
            throw new Error(`'${JSON.stringify(perms)}' must be a JSON object`);
          }
        }
      } catch (e) {
        _logger.default.errorAndThrow(`'${caps.permissions}' is expected to be a valid object with format ` + `{"<bundleId1>": {"<serviceName1>": "<serviceStatus1>", ...}, ...}. Original error: ${e.message}`);
      }
    }

    if (caps.platformVersion && !_appiumSupport.util.coerceVersion(caps.platformVersion, false)) {
      _logger.default.errorAndThrow(`'platformVersion' must be a valid version number. ` + `'${caps.platformVersion}' is given instead.`);
    }

    return true;
  }

  async installAUT() {
    if (this.isSafari()) {
      return;
    }

    if (this.opts.autoLaunch === false) {
      return;
    }

    try {
      await (0, _utils.verifyApplicationPlatform)(this.opts.app, this.isSimulator(), (0, _utils.isTvOS)(this.opts.platformName));
    } catch (err) {
      _logger.default.warn(`*********************************`);

      _logger.default.warn(`${this.isSimulator() ? 'Simulator' : 'Real device'} architecture appears to be unsupported ` + `by the '${this.opts.app}' application. ` + `Make sure the correct deployment target has been selected for its compilation in Xcode.`);

      _logger.default.warn('Don\'t be surprised if the application fails to launch.');

      _logger.default.warn(`*********************************`);
    }

    if (this.isRealDevice()) {
      await (0, _realDeviceManagement.installToRealDevice)(this.opts.device, this.opts.app, this.opts.bundleId, this.opts.noReset);
    } else {
      await (0, _simulatorManagement.installToSimulator)(this.opts.device, this.opts.app, this.opts.bundleId, this.opts.noReset);
    }

    if (_appiumSupport.util.hasValue(this.opts.iosInstallPause)) {
      let pause = parseInt(this.opts.iosInstallPause, 10);

      _logger.default.debug(`iosInstallPause set. Pausing ${pause} ms before continuing`);

      await _bluebird.default.delay(pause);
    }
  }

  async setInitialOrientation(orientation) {
    if (!_lodash.default.isString(orientation)) {
      _logger.default.info('Skipping setting of the initial display orientation. ' + 'Set the "orientation" capability to either "LANDSCAPE" or "PORTRAIT", if this is an undesired behavior.');

      return;
    }

    orientation = orientation.toUpperCase();

    if (!_lodash.default.includes(['LANDSCAPE', 'PORTRAIT'], orientation)) {
      _logger.default.debug(`Unable to set initial orientation to '${orientation}'`);

      return;
    }

    _logger.default.debug(`Setting initial orientation to '${orientation}'`);

    try {
      await this.proxyCommand('/orientation', 'POST', {
        orientation
      });
      this.opts.curOrientation = orientation;
    } catch (err) {
      _logger.default.warn(`Setting initial orientation failed with: ${err.message}`);
    }
  }

  _getCommandTimeout(cmdName) {
    if (this.opts.commandTimeouts) {
      if (cmdName && _lodash.default.has(this.opts.commandTimeouts, cmdName)) {
        return this.opts.commandTimeouts[cmdName];
      }

      return this.opts.commandTimeouts[_utils.DEFAULT_TIMEOUT_KEY];
    }
  }

  async getSession() {
    const driverSession = await super.getSession();

    if (!this.wdaCaps) {
      this.wdaCaps = await this.proxyCommand('/', 'GET');
    }

    if (!this.deviceCaps) {
      const {
        statusBarSize,
        scale
      } = await this.getScreenInfo();
      this.deviceCaps = {
        pixelRatio: scale,
        statBarHeight: statusBarSize.height,
        viewportRect: await this.getViewportRect()
      };
    }

    _logger.default.info('Merging WDA caps over Appium caps for session detail response');

    return Object.assign({
      udid: this.opts.udid
    }, driverSession, this.wdaCaps.capabilities, this.deviceCaps);
  }

  async startIWDP() {
    this.logEvent('iwdpStarting');
    this.iwdpServer = new _appiumIosDriver.IWDP({
      webkitDebugProxyPort: this.opts.webkitDebugProxyPort,
      udid: this.opts.udid,
      logStdout: !!this.opts.showIWDPLog
    });
    await this.iwdpServer.start();
    this.logEvent('iwdpStarted');
  }

  async stopIWDP() {
    if (this.iwdpServer) {
      await this.iwdpServer.stop();
      delete this.iwdpServer;
    }
  }

  async reset() {
    if (this.opts.noReset) {
      let opts = _lodash.default.cloneDeep(this.opts);

      opts.noReset = false;
      opts.fullReset = false;
      const shutdownHandler = this.resetOnUnexpectedShutdown;

      this.resetOnUnexpectedShutdown = () => {};

      try {
        await this.runReset(opts);
      } finally {
        this.resetOnUnexpectedShutdown = shutdownHandler;
      }
    }

    await super.reset();
  }

}

exports.XCUITestDriver = XCUITestDriver;
Object.assign(XCUITestDriver.prototype, _index.default);
var _default = XCUITestDriver;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9kcml2ZXIuanMiXSwibmFtZXMiOlsiU0FGQVJJX0JVTkRMRV9JRCIsIldEQV9TSU1fU1RBUlRVUF9SRVRSSUVTIiwiV0RBX1JFQUxfREVWX1NUQVJUVVBfUkVUUklFUyIsIldEQV9SRUFMX0RFVl9UVVRPUklBTF9VUkwiLCJXREFfU1RBUlRVUF9SRVRSWV9JTlRFUlZBTCIsIkRFRkFVTFRfU0VUVElOR1MiLCJuYXRpdmVXZWJUYXAiLCJ1c2VKU09OU291cmNlIiwic2hvdWxkVXNlQ29tcGFjdFJlc3BvbnNlcyIsImVsZW1lbnRSZXNwb25zZUF0dHJpYnV0ZXMiLCJtanBlZ1NlcnZlclNjcmVlbnNob3RRdWFsaXR5IiwibWpwZWdTZXJ2ZXJGcmFtZXJhdGUiLCJzY3JlZW5zaG90UXVhbGl0eSIsIm1qcGVnU2NhbGluZ0ZhY3RvciIsIlNIQVJFRF9SRVNPVVJDRVNfR1VBUkQiLCJBc3luY0xvY2siLCJOT19QUk9YWV9OQVRJVkVfTElTVCIsIk5PX1BST1hZX1dFQl9MSVNUIiwiY29uY2F0IiwiTUVNT0laRURfRlVOQ1RJT05TIiwiWENVSVRlc3REcml2ZXIiLCJCYXNlRHJpdmVyIiwiY29uc3RydWN0b3IiLCJvcHRzIiwic2hvdWxkVmFsaWRhdGVDYXBzIiwiZGVzaXJlZENhcENvbnN0cmFpbnRzIiwibG9jYXRvclN0cmF0ZWdpZXMiLCJ3ZWJMb2NhdG9yU3RyYXRlZ2llcyIsInJlc2V0SW9zIiwic2V0dGluZ3MiLCJEZXZpY2VTZXR0aW5ncyIsIm9uU2V0dGluZ3NVcGRhdGUiLCJiaW5kIiwibG9ncyIsImZuIiwiXyIsIm1lbW9pemUiLCJrZXkiLCJ2YWx1ZSIsInByb3h5Q29tbWFuZCIsIndkYSIsImRldmljZSIsImp3cFByb3h5QWN0aXZlIiwicHJveHlSZXFSZXMiLCJqd3BQcm94eUF2b2lkIiwic2FmYXJpIiwiY2FjaGVkV2RhU3RhdHVzIiwiY3VyV2ViRnJhbWVzIiwid2ViRWxlbWVudElkcyIsIl9jdXJyZW50VXJsIiwiY3VyQ29udGV4dCIsInhjb2RlVmVyc2lvbiIsImNvbnRleHRzIiwiaW1wbGljaXRXYWl0TXMiLCJhc3luY2xpYldhaXRNcyIsInBhZ2VMb2FkTXMiLCJsYW5kc2NhcGVXZWJDb29yZHNPZmZzZXQiLCJkcml2ZXJEYXRhIiwiZ2V0U3RhdHVzIiwiZHJpdmVySW5mbyIsInN0YXR1cyIsImJ1aWxkIiwidmVyc2lvbiIsImNyZWF0ZVNlc3Npb24iLCJhcmdzIiwibGlmZWN5Y2xlRGF0YSIsInNlc3Npb25JZCIsImNhcHMiLCJzdGFydCIsIk9iamVjdCIsImFzc2lnbiIsImRlZmF1bHRTZXJ2ZXJDYXBzIiwidWRpZCIsImhhcyIsInVwZGF0ZVNldHRpbmdzIiwid2RhU2V0dGluZ3MiLCJsb2ciLCJpbmZvIiwibWpwZWdTY3JlZW5zaG90VXJsIiwibWpwZWdTdHJlYW0iLCJtanBlZyIsIk1KcGVnU3RyZWFtIiwiZSIsImVycm9yIiwiZGVsZXRlU2Vzc2lvbiIsIm5vUmVzZXQiLCJmdWxsUmVzZXQiLCJpb3NTZGtWZXJzaW9uIiwicmVhbERldmljZSIsImRldGVybWluZURldmljZSIsIm5vcm1hbGl6ZWRWZXJzaW9uIiwicGxhdGZvcm1WZXJzaW9uIiwidXRpbCIsImNvbXBhcmVWZXJzaW9ucyIsIkVycm9yIiwiaXNFbXB0eSIsIndlYkRyaXZlckFnZW50VXJsIiwibG9nRXZlbnQiLCJlbmFibGVBc3luY0V4ZWN1dGVGcm9tSHR0cHMiLCJpc1JlYWxEZXZpY2UiLCJzdGFydEh0dHBzQXN5bmNTZXJ2ZXIiLCJpc0Z1bmN0aW9uIiwiZ2V0UGxhdGZvcm1WZXJzaW9uIiwiYnJvd3Nlck5hbWUiLCJ0b0xvd2VyQ2FzZSIsImFwcCIsInVuZGVmaW5lZCIsInByb2Nlc3NBcmd1bWVudHMiLCJidW5kbGVJZCIsInNhZmFyaUluaXRpYWxVcmwiLCJhZGRyZXNzIiwicG9ydCIsImNvbmZpZ3VyZUFwcCIsImFwcFV0aWxzIiwiZXh0cmFjdEJ1bmRsZUlkIiwicnVuUmVzZXQiLCJtZW1vaXplZExvZ0luZm8iLCJsb2dJbmZvIiwic3RhcnRMb2dDYXB0dXJlIiwic2tpcExvZ0NhcHR1cmUiLCJyZXN1bHQiLCJpc0xvZ0NhcHR1cmVTdGFydGVkIiwiaXNTaW11bGF0b3IiLCJzaHV0ZG93bk90aGVyU2ltdWxhdG9ycyIsInJlbGF4ZWRTZWN1cml0eUVuYWJsZWQiLCJlcnJvckFuZFRocm93IiwiaGFzVmFsdWUiLCJyZWR1Y2VNb3Rpb24iLCJzZXRSZWR1Y2VNb3Rpb24iLCJsb2NhbENvbmZpZyIsImlvc1NldHRpbmdzIiwic2V0TG9jYWxlQW5kUHJlZmVyZW5jZXMiLCJpc1NhZmFyaSIsInNpbSIsInN0YXJ0U2ltIiwiY3VzdG9tU1NMQ2VydCIsInRydW5jYXRlIiwibGVuZ3RoIiwiaWRiIiwiSURCIiwiY29ubmVjdCIsIm1lc3NhZ2UiLCJpbnN0YWxsQVVUIiwiaXNBcHBJbnN0YWxsZWQiLCJwZXJtaXNzaW9ucyIsImRlYnVnIiwicGVybWlzc2lvbnNNYXBwaW5nIiwidG9QYWlycyIsIkpTT04iLCJwYXJzZSIsInNldFBlcm1pc3Npb25zIiwid2FybiIsInN0YXJ0V2RhIiwic2V0SW5pdGlhbE9yaWVudGF0aW9uIiwib3JpZW50YXRpb24iLCJzdGFydElXRFAiLCJpd2RwU2VydmVyIiwiZW5kcG9pbnQiLCJlcnIiLCJhdXRvV2VidmlldyIsIm5hdlRvSW5pdGlhbFdlYnZpZXciLCJzZXRVcmwiLCJjYWxlbmRhckFjY2Vzc0F1dGhvcml6ZWQiLCJlbmFibGVDYWxlbmRhckFjY2VzcyIsImRpc2FibGVDYWxlbmRhckFjY2VzcyIsIldlYkRyaXZlckFnZW50IiwiY2xlYW51cE9ic29sZXRlUHJvY2Vzc2VzIiwic3luY2hyb25pemF0aW9uS2V5IiwidXNlWGN0ZXN0cnVuRmlsZSIsImlzU291cmNlRnJlc2giLCJuYW1lIiwicGF0aCIsIm5vcm1hbGl6ZSIsInJldHJpZXZlRGVyaXZlZERhdGFQYXRoIiwiaXNCdXN5IiwiZGVyaXZlZERhdGFQYXRoIiwiYm9vdHN0cmFwUGF0aCIsImFjcXVpcmUiLCJ1c2VOZXdXREEiLCJxdWl0QW5kVW5pbnN0YWxsIiwic2V0dXBDYWNoaW5nIiwidXBkYXRlZFdEQUJ1bmRsZUlkIiwibXNnIiwic3RhcnR1cFJldHJpZXMiLCJ3ZGFTdGFydHVwUmV0cmllcyIsInN0YXJ0dXBSZXRyeUludGVydmFsIiwid2RhU3RhcnR1cFJldHJ5SW50ZXJ2YWwiLCJyZXRyeUNvdW50IiwicmV0cmllcyIsIm1ham9yIiwibGF1bmNoIiwiZXJyb3JNc2ciLCJvcmlnaW5hbFN0YWNrdHJhY2UiLCJzdGFydFdkYVNlc3Npb24iLCJzdGFjayIsImNsZWFyU3lzdGVtRmlsZXMiLCJmdWxseVN0YXJ0ZWQiLCJzZXJ2ZXIiLCJkaXNjb25uZWN0Iiwic3RvcCIsImlzQXBwVGVtcG9yYXJ5IiwiZnMiLCJyaW1yYWYiLCJpc1dlYkNvbnRleHQiLCJzdG9wUmVtb3RlIiwicmVzZXRPblNlc3Npb25TdGFydE9ubHkiLCJlbmZvcmNlU2ltdWxhdG9yU2h1dGRvd24iLCJjcmVhdGVTaW0iLCJkZWxldGUiLCJzeXNsb2ciLCJzdG9wQ2FwdHVyZSIsInN0b3BJV0RQIiwic3RvcEh0dHBzQXN5bmNTZXJ2ZXIiLCJqd3Byb3h5IiwicXVpdCIsImV4ZWN1dGVDb21tYW5kIiwiY21kIiwicmVjZWl2ZUFzeW5jUmVzcG9uc2UiLCJhcHBJc1BhY2thZ2VPckJ1bmRsZSIsInRlc3QiLCJvcmlnaW5hbEFwcFBhdGgiLCJoZWxwZXJzIiwiZXhpc3RzIiwiaXNTYW1lRGVzdGluYXRpb24iLCJkZXZpY2VOYW1lIiwic2V0dXBWZXJzaW9uQ2FwcyIsImRldmljZVBsYXRmb3JtIiwiZGV2aWNlcyIsImpvaW4iLCJpbmNsdWRlcyIsInN0ZG91dCIsImNvZXJjZVZlcnNpb24iLCJ0cmltIiwiZW5mb3JjZUZyZXNoU2ltdWxhdG9yQ3JlYXRpb24iLCJydW5PcHRzIiwic2NhbGVGYWN0b3IiLCJjb25uZWN0SGFyZHdhcmVLZXlib2FyZCIsImlzSGVhZGxlc3MiLCJkZXZpY2VQcmVmZXJlbmNlcyIsIlNpbXVsYXRvcldpbmRvd0NlbnRlciIsImlzU3RyaW5nIiwidG9VcHBlckNhc2UiLCJTaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbiIsIlNpbXVsYXRvcldpbmRvd1JvdGF0aW9uQW5nbGUiLCJydW4iLCJwbGF0Zm9ybU5hbWUiLCJQTEFURk9STV9OQU1FX1RWT1MiLCJQTEFURk9STV9OQU1FX0lPUyIsImxhdW5jaEFwcCIsIkFQUF9MQVVOQ0hfVElNRU9VVCIsImNoZWNrU3RhdHVzIiwicmVzcG9uc2UiLCJjdXJyZW50QXBwIiwiYnVuZGxlSUQiLCJwYXJzZUludCIsImlzQXJyYXkiLCJzdHJpbmdpZnkiLCJlbnYiLCJpc1BsYWluT2JqZWN0Iiwic2hvdWxkV2FpdEZvclF1aWVzY2VuY2UiLCJ3YWl0Rm9yUXVpZXNjZW5jZSIsIm1heFR5cGluZ0ZyZXF1ZW5jeSIsInNob3VsZFVzZVNpbmdsZXRvblRlc3RNYW5hZ2VyIiwic2hvdWxkVXNlVGVzdE1hbmFnZXJGb3JWaXNpYmlsaXR5RGV0ZWN0aW9uIiwiZXZlbnRsb29wSWRsZURlbGF5U2VjIiwid2RhRXZlbnRsb29wSWRsZURlbGF5Iiwic2ltcGxlSXNWaXNpYmxlQ2hlY2siLCJsYW5ndWFnZSIsInB1c2giLCJsb2NhbGUiLCJkZXNpcmVkIiwiZGVzaXJlZENhcGFiaWxpdGllcyIsImFyZ3VtZW50cyIsImVudmlyb25tZW50IiwiZWxlbWVudFJlc3BvbnNlRmllbGRzIiwiYXV0b0FjY2VwdEFsZXJ0cyIsImRlZmF1bHRBbGVydEFjdGlvbiIsImF1dG9EaXNtaXNzQWxlcnRzIiwicHJveHlBY3RpdmUiLCJnZXRQcm94eUF2b2lkTGlzdCIsImlzV2VidmlldyIsImNhblByb3h5IiwidmFsaWRhdGVMb2NhdG9yU3RyYXRlZ3kiLCJzdHJhdGVneSIsInZhbGlkYXRlRGVzaXJlZENhcHMiLCJ2ZXJpZnlQcm9jZXNzQXJndW1lbnQiLCJpc05pbCIsImtleWNoYWluUGF0aCIsImtleWNoYWluUGFzc3dvcmQiLCJjb21tYW5kVGltZW91dHMiLCJwcm90b2NvbCIsImhvc3QiLCJ1cmwiLCJwZXJtcyIsImF1dG9MYXVuY2giLCJpb3NJbnN0YWxsUGF1c2UiLCJwYXVzZSIsIkIiLCJkZWxheSIsImN1ck9yaWVudGF0aW9uIiwiX2dldENvbW1hbmRUaW1lb3V0IiwiY21kTmFtZSIsIkRFRkFVTFRfVElNRU9VVF9LRVkiLCJnZXRTZXNzaW9uIiwiZHJpdmVyU2Vzc2lvbiIsIndkYUNhcHMiLCJkZXZpY2VDYXBzIiwic3RhdHVzQmFyU2l6ZSIsInNjYWxlIiwiZ2V0U2NyZWVuSW5mbyIsInBpeGVsUmF0aW8iLCJzdGF0QmFySGVpZ2h0IiwiaGVpZ2h0Iiwidmlld3BvcnRSZWN0IiwiZ2V0Vmlld3BvcnRSZWN0IiwiY2FwYWJpbGl0aWVzIiwiSVdEUCIsIndlYmtpdERlYnVnUHJveHlQb3J0IiwibG9nU3Rkb3V0Iiwic2hvd0lXRFBMb2ciLCJyZXNldCIsImNsb25lRGVlcCIsInNodXRkb3duSGFuZGxlciIsInJlc2V0T25VbmV4cGVjdGVkU2h1dGRvd24iLCJwcm90b3R5cGUiLCJjb21tYW5kcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFPQTs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxnQkFBZ0IsR0FBRyx3QkFBekI7QUFDQSxNQUFNQyx1QkFBdUIsR0FBRyxDQUFoQztBQUNBLE1BQU1DLDRCQUE0QixHQUFHLENBQXJDO0FBQ0EsTUFBTUMseUJBQXlCLEdBQUcseUZBQWxDO0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsS0FBbkM7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRztBQUN2QkMsRUFBQUEsWUFBWSxFQUFFLEtBRFM7QUFFdkJDLEVBQUFBLGFBQWEsRUFBRSxLQUZRO0FBR3ZCQyxFQUFBQSx5QkFBeUIsRUFBRSxJQUhKO0FBSXZCQyxFQUFBQSx5QkFBeUIsRUFBRSxZQUpKO0FBTXZCQyxFQUFBQSw0QkFBNEIsRUFBRSxFQU5QO0FBT3ZCQyxFQUFBQSxvQkFBb0Is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QUsxUyxJQUFqQixDQUFYOztBQUNBQSxNQUFBQSxJQUFJLENBQUM4RCxPQUFMLEdBQWUsS0FBZjtBQUNBOUQsTUFBQUEsSUFBSSxDQUFDK0QsU0FBTCxHQUFpQixLQUFqQjtBQUNBLFlBQU00TyxlQUFlLEdBQUcsS0FBS0MseUJBQTdCOztBQUNBLFdBQUtBLHlCQUFMLEdBQWlDLE1BQU0sQ0FBRSxDQUF6Qzs7QUFDQSxVQUFJO0FBQ0YsY0FBTSxLQUFLaE4sUUFBTCxDQUFjNUYsSUFBZCxDQUFOO0FBQ0QsT0FGRCxTQUVVO0FBQ1IsYUFBSzRTLHlCQUFMLEdBQWlDRCxlQUFqQztBQUNEO0FBQ0Y7O0FBQ0QsVUFBTSxNQUFNRixLQUFOLEVBQU47QUFDRDs7QUF6a0NxQzs7O0FBNGtDeEMzUCxNQUFNLENBQUNDLE1BQVAsQ0FBY2xELGNBQWMsQ0FBQ2dULFNBQTdCLEVBQXdDQyxjQUF4QztlQUVlalQsYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VEcml2ZXIsIERldmljZVNldHRpbmdzIH0gZnJvbSAnYXBwaXVtLWJhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwsIGZzLCBtanBlZyB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgdXJsIGZyb20gJ3VybCc7XG5pbXBvcnQgeyBsYXVuY2gsIG9wZW5VcmwgfSBmcm9tICdub2RlLXNpbWN0bCc7XG5pbXBvcnQgV2ViRHJpdmVyQWdlbnQgZnJvbSAnLi93ZGEvd2ViZHJpdmVyYWdlbnQnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQge1xuICBjcmVhdGVTaW0sIGdldEV4aXN0aW5nU2ltLCBydW5TaW11bGF0b3JSZXNldCwgaW5zdGFsbFRvU2ltdWxhdG9yLFxuICBzaHV0ZG93bk90aGVyU2ltdWxhdG9ycywgc2h1dGRvd25TaW11bGF0b3IgfSBmcm9tICcuL3NpbXVsYXRvci1tYW5hZ2VtZW50JztcbmltcG9ydCB7IHNpbUV4aXN0cywgZ2V0U2ltdWxhdG9yLCBpbnN0YWxsU1NMQ2VydCwgaGFzU1NMQ2VydCB9IGZyb20gJ2FwcGl1bS1pb3Mtc2ltdWxhdG9yJztcbmltcG9ydCB7IHJldHJ5SW50ZXJ2YWwsIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgc2V0dGluZ3MgYXMgaW9zU2V0dGluZ3MsIGRlZmF1bHRTZXJ2ZXJDYXBzLCBhcHBVdGlscywgSVdEUCB9IGZyb20gJ2FwcGl1bS1pb3MtZHJpdmVyJztcbmltcG9ydCB7IGRlc2lyZWRDYXBDb25zdHJhaW50cywgUExBVEZPUk1fTkFNRV9JT1MsIFBMQVRGT1JNX05BTUVfVFZPUyB9IGZyb20gJy4vZGVzaXJlZC1jYXBzJztcbmltcG9ydCBjb21tYW5kcyBmcm9tICcuL2NvbW1hbmRzL2luZGV4JztcbmltcG9ydCB7XG4gIGRldGVjdFVkaWQsIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uLCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24sXG4gIGNoZWNrQXBwUHJlc2VudCwgZ2V0RHJpdmVySW5mbyxcbiAgY2xlYXJTeXN0ZW1GaWxlcywgdHJhbnNsYXRlRGV2aWNlTmFtZSwgbm9ybWFsaXplQ29tbWFuZFRpbWVvdXRzLFxuICBERUZBVUxUX1RJTUVPVVRfS0VZLCBtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwLFxuICBwcmludFVzZXIsIHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycywgdmVyaWZ5QXBwbGljYXRpb25QbGF0Zm9ybSwgaXNUdk9TLFxuICBub3JtYWxpemVQbGF0Zm9ybVZlcnNpb24gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7XG4gIGdldENvbm5lY3RlZERldmljZXMsIHJ1blJlYWxEZXZpY2VSZXNldCwgaW5zdGFsbFRvUmVhbERldmljZSxcbiAgZ2V0UmVhbERldmljZU9iaiB9IGZyb20gJy4vcmVhbC1kZXZpY2UtbWFuYWdlbWVudCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgQXN5bmNMb2NrIGZyb20gJ2FzeW5jLWxvY2snO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgSURCIGZyb20gJ2FwcGl1bS1pZGInO1xuXG5cbmNvbnN0IFNBRkFSSV9CVU5ETEVfSUQgPSAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaSc7XG5jb25zdCBXREFfU0lNX1NUQVJUVVBfUkVUUklFUyA9IDI7XG5jb25zdCBXREFfUkVBTF9ERVZfU1RBUlRVUF9SRVRSSUVTID0gMTtcbmNvbnN0IFdEQV9SRUFMX0RFVl9UVVRPUklBTF9VUkwgPSAnaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0teGN1aXRlc3QtZHJpdmVyL2Jsb2IvbWFzdGVyL2RvY3MvcmVhbC1kZXZpY2UtY29uZmlnLm1kJztcbmNvbnN0IFdEQV9TVEFSVFVQX1JFVFJZX0lOVEVSVkFMID0gMTAwMDA7XG5jb25zdCBERUZBVUxUX1NFVFRJTkdTID0ge1xuICBuYXRpdmVXZWJUYXA6IGZhbHNlLFxuICB1c2VKU09OU291cmNlOiBmYWxzZSxcbiAgc2hvdWxkVXNlQ29tcGFjdFJlc3BvbnNlczogdHJ1ZSxcbiAgZWxlbWVudFJlc3BvbnNlQXR0cmlidXRlczogJ3R5cGUsbGFiZWwnLFxuICAvLyBSZWFkIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vV2ViRHJpdmVyQWdlbnQvYmxvYi9tYXN0ZXIvV2ViRHJpdmVyQWdlbnRMaWIvVXRpbGl0aWVzL0ZCQ29uZmlndXJhdGlvbi5tIGZvciBmb2xsb3dpbmcgc2V0dGluZ3MnIHZhbHVlc1xuICBtanBlZ1NlcnZlclNjcmVlbnNob3RRdWFsaXR5OiAyNSxcbiAgbWpwZWdTZXJ2ZXJGcmFtZXJhdGU6IDEwLFxuICBzY3JlZW5zaG90UXVhbGl0eTogMSxcbiAgbWpwZWdTY2FsaW5nRmFjdG9yOiAxMDAsXG59O1xuLy8gVGhpcyBsb2NrIGFzc3VyZXMsIHRoYXQgZWFjaCBkcml2ZXIgc2Vzc2lvbiBkb2VzIG5vdFxuLy8gYWZmZWN0IHNoYXJlZCByZXNvdXJjZXMgb2YgdGhlIG90aGVyIHBhcmFsbGVsIHNlc3Npb25zXG5jb25zdCBTSEFSRURfUkVTT1VSQ0VTX0dVQVJEID0gbmV3IEFzeW5jTG9jaygpO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby11c2VsZXNzLWVzY2FwZSAqL1xuY29uc3QgTk9fUFJPWFlfTkFUSVZFX0xJU1QgPSBbXG4gIFsnREVMRVRFJywgL3dpbmRvdy9dLFxuICBbJ0dFVCcsIC9eXFwvc2Vzc2lvblxcL1teXFwvXSskL10sXG4gIFsnR0VUJywgL2FsZXJ0X3RleHQvXSxcbiAgWydHRVQnLCAvYWxlcnRcXC9bXlxcL10rL10sXG4gIFsnR0VUJywgL2FwcGl1bS9dLFxuICBbJ0dFVCcsIC9hdHRyaWJ1dGUvXSxcbiAgWydHRVQnLCAvY29udGV4dC9dLFxuICBbJ0dFVCcsIC9sb2NhdGlvbi9dLFxuICBbJ0dFVCcsIC9sb2cvXSxcbiAgWydHRVQnLCAvc2NyZWVuc2hvdC9dLFxuICBbJ0dFVCcsIC9zaXplL10sXG4gIFsnR0VUJywgL3NvdXJjZS9dLFxuICBbJ0dFVCcsIC91cmwvXSxcbiAgWydHRVQnLCAvd2luZG93L10sXG4gIFsnUE9TVCcsIC9hY2NlcHRfYWxlcnQvXSxcbiAgWydQT1NUJywgL2FjdGlvbnMkL10sXG4gIFsnUE9TVCcsIC9hbGVydF90ZXh0L10sXG4gIFsnUE9TVCcsIC9hbGVydFxcL1teXFwvXSsvXSxcbiAgWydQT1NUJywgL2FwcGl1bS9dLFxuICBbJ1BPU1QnLCAvYXBwaXVtXFwvZGV2aWNlXFwvaXNfbG9ja2VkL10sXG4gIFsnUE9TVCcsIC9hcHBpdW1cXC9kZXZpY2VcXC9sb2NrL10sXG4gIFsnUE9TVCcsIC9hcHBpdW1cXC9kZXZpY2VcXC91bmxvY2svXSxcbiAgWydQT1NUJywgL2JhY2svXSxcbiAgWydQT1NUJywgL2NsZWFyL10sXG4gIFsnUE9TVCcsIC9jb250ZXh0L10sXG4gIFsnUE9TVCcsIC9kaXNtaXNzX2FsZXJ0L10sXG4gIFsnUE9TVCcsIC9lbGVtZW50JC9dLFxuICBbJ1BPU1QnLCAvZWxlbWVudHMkL10sXG4gIFsnUE9TVCcsIC9leGVjdXRlL10sXG4gIFsnUE9TVCcsIC9rZXlzL10sXG4gIFsnUE9TVCcsIC9sb2cvXSxcbiAgWydQT1NUJywgL21vdmV0by9dLFxuICBbJ1BPU1QnLCAvcmVjZWl2ZV9hc3luY19yZXNwb25zZS9dLCAvLyBhbHdheXMsIGluIGNhc2UgY29udGV4dCBzd2l0Y2hlcyB3aGlsZSB3YWl0aW5nXG4gIFsnUE9TVCcsIC9zZXNzaW9uXFwvW15cXC9dK1xcL2xvY2F0aW9uL10sIC8vIGdlbyBsb2NhdGlvbiwgYnV0IG5vdCBlbGVtZW50IGxvY2F0aW9uXG4gIFsnUE9TVCcsIC9zaGFrZS9dLFxuICBbJ1BPU1QnLCAvdGltZW91dHMvXSxcbiAgWydQT1NUJywgL3RvdWNoL10sXG4gIFsnUE9TVCcsIC91cmwvXSxcbiAgWydQT1NUJywgL3ZhbHVlL10sXG4gIFsnUE9TVCcsIC93aW5kb3cvXSxcbl07XG5jb25zdCBOT19QUk9YWV9XRUJfTElTVCA9IFtcbiAgWydERUxFVEUnLCAvY29va2llL10sXG4gIFsnR0VUJywgL2F0dHJpYnV0ZS9dLFxuICBbJ0dFVCcsIC9jb29raWUvXSxcbiAgWydHRVQnLCAvZWxlbWVudC9dLFxuICBbJ0dFVCcsIC90ZXh0L10sXG4gIFsnR0VUJywgL3RpdGxlL10sXG4gIFsnUE9TVCcsIC9jbGVhci9dLFxuICBbJ1BPU1QnLCAvY2xpY2svXSxcbiAgWydQT1NUJywgL2Nvb2tpZS9dLFxuICBbJ1BPU1QnLCAvZWxlbWVudC9dLFxuICBbJ1BPU1QnLCAvZm9yd2FyZC9dLFxuICBbJ1BPU1QnLCAvZnJhbWUvXSxcbiAgWydQT1NUJywgL2tleXMvXSxcbiAgWydQT1NUJywgL3JlZnJlc2gvXSxcbl0uY29uY2F0KE5PX1BST1hZX05BVElWRV9MSVNUKTtcbi8qIGVzbGludC1lbmFibGUgbm8tdXNlbGVzcy1lc2NhcGUgKi9cblxuY29uc3QgTUVNT0laRURfRlVOQ1RJT05TID0gW1xuICAnZ2V0U3RhdHVzQmFySGVpZ2h0JyxcbiAgJ2dldERldmljZVBpeGVsUmF0aW8nLFxuICAnZ2V0U2NyZWVuSW5mbycsXG4gICdnZXRTYWZhcmlJc0lwaG9uZScsXG4gICdnZXRTYWZhcmlJc0lwaG9uZVgnLFxuXTtcblxuY2xhc3MgWENVSVRlc3REcml2ZXIgZXh0ZW5kcyBCYXNlRHJpdmVyIHtcbiAgY29uc3RydWN0b3IgKG9wdHMgPSB7fSwgc2hvdWxkVmFsaWRhdGVDYXBzID0gdHJ1ZSkge1xuICAgIHN1cGVyKG9wdHMsIHNob3VsZFZhbGlkYXRlQ2Fwcyk7XG5cbiAgICB0aGlzLmRlc2lyZWRDYXBDb25zdHJhaW50cyA9IGRlc2lyZWRDYXBDb25zdHJhaW50cztcblxuICAgIHRoaXMubG9jYXRvclN0cmF0ZWdpZXMgPSBbXG4gICAgICAneHBhdGgnLFxuICAgICAgJ2lkJyxcbiAgICAgICduYW1lJyxcbiAgICAgICdjbGFzcyBuYW1lJyxcbiAgICAgICctaW9zIHByZWRpY2F0ZSBzdHJpbmcnLFxuICAgICAgJy1pb3MgY2xhc3MgY2hhaW4nLFxuICAgICAgJ2FjY2Vzc2liaWxpdHkgaWQnXG4gICAgXTtcbiAgICB0aGlzLndlYkxvY2F0b3JTdHJhdGVnaWVzID0gW1xuICAgICAgJ2xpbmsgdGV4dCcsXG4gICAgICAnY3NzIHNlbGVjdG9yJyxcbiAgICAgICd0YWcgbmFtZScsXG4gICAgICAnbGluayB0ZXh0JyxcbiAgICAgICdwYXJ0aWFsIGxpbmsgdGV4dCdcbiAgICBdO1xuICAgIHRoaXMucmVzZXRJb3MoKTtcbiAgICB0aGlzLnNldHRpbmdzID0gbmV3IERldmljZVNldHRpbmdzKERFRkFVTFRfU0VUVElOR1MsIHRoaXMub25TZXR0aW5nc1VwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmxvZ3MgPSB7fTtcblxuICAgIC8vIG1lbW9pemUgZnVuY3Rpb25zIGhlcmUsIHNvIHRoYXQgdGhleSBhcmUgZG9uZSBvbiBhIHBlci1pbnN0YW5jZSBiYXNpc1xuICAgIGZvciAoY29uc3QgZm4gb2YgTUVNT0laRURfRlVOQ1RJT05TKSB7XG4gICAgICB0aGlzW2ZuXSA9IF8ubWVtb2l6ZSh0aGlzW2ZuXSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgb25TZXR0aW5nc1VwZGF0ZSAoa2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgIT09ICduYXRpdmVXZWJUYXAnKSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9hcHBpdW0vc2V0dGluZ3MnLCAnUE9TVCcsIHtcbiAgICAgICAgc2V0dGluZ3M6IHtba2V5XTogdmFsdWV9XG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5vcHRzLm5hdGl2ZVdlYlRhcCA9ICEhdmFsdWU7XG4gIH1cblxuICByZXNldElvcyAoKSB7XG4gICAgdGhpcy5vcHRzID0gdGhpcy5vcHRzIHx8IHt9O1xuICAgIHRoaXMud2RhID0gbnVsbDtcbiAgICB0aGlzLm9wdHMuZGV2aWNlID0gbnVsbDtcbiAgICB0aGlzLmp3cFByb3h5QWN0aXZlID0gZmFsc2U7XG4gICAgdGhpcy5wcm94eVJlcVJlcyA9IG51bGw7XG4gICAgdGhpcy5qd3BQcm94eUF2b2lkID0gW107XG4gICAgdGhpcy5zYWZhcmkgPSBmYWxzZTtcbiAgICB0aGlzLmNhY2hlZFdkYVN0YXR1cyA9IG51bGw7XG5cbiAgICAvLyBzb21lIHRoaW5ncyB0aGF0IGNvbW1hbmRzIGltcG9ydGVkIGZyb20gYXBwaXVtLWlvcy1kcml2ZXIgbmVlZFxuICAgIHRoaXMuY3VyV2ViRnJhbWVzID0gW107XG4gICAgdGhpcy53ZWJFbGVtZW50SWRzID0gW107XG4gICAgdGhpcy5fY3VycmVudFVybCA9IG51bGw7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gbnVsbDtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHt9O1xuICAgIHRoaXMuY29udGV4dHMgPSBbXTtcbiAgICB0aGlzLmltcGxpY2l0V2FpdE1zID0gMDtcbiAgICB0aGlzLmFzeW5jbGliV2FpdE1zID0gMDtcbiAgICB0aGlzLnBhZ2VMb2FkTXMgPSA2MDAwO1xuICAgIHRoaXMubGFuZHNjYXBlV2ViQ29vcmRzT2Zmc2V0ID0gMDtcbiAgfVxuXG4gIGdldCBkcml2ZXJEYXRhICgpIHtcbiAgICAvLyBUT0RPIGZpbGwgb3V0IHJlc291cmNlIGluZm8gaGVyZVxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGFzeW5jIGdldFN0YXR1cyAoKSB7XG4gICAgaWYgKHR5cGVvZiB0aGlzLmRyaXZlckluZm8gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0aGlzLmRyaXZlckluZm8gPSBhd2FpdCBnZXREcml2ZXJJbmZvKCk7XG4gICAgfVxuICAgIGxldCBzdGF0dXMgPSB7YnVpbGQ6IHt2ZXJzaW9uOiB0aGlzLmRyaXZlckluZm8udmVyc2lvbn19O1xuICAgIGlmICh0aGlzLmNhY2hlZFdkYVN0YXR1cykge1xuICAgICAgc3RhdHVzLndkYSA9IHRoaXMuY2FjaGVkV2RhU3RhdHVzO1xuICAgIH1cbiAgICByZXR1cm4gc3RhdHVzO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlU2Vzc2lvbiAoLi4uYXJncykge1xuICAgIHRoaXMubGlmZWN5Y2xlRGF0YSA9IHt9OyAvLyB0aGlzIGlzIHVzZWQgZm9yIGtlZXBpbmcgdHJhY2sgb2YgdGhlIHN0YXRlIHdlIHN0YXJ0IHNvIHdoZW4gd2UgZGVsZXRlIHRoZSBzZXNzaW9uIHdlIGNhbiBwdXQgdGhpbmdzIGJhY2tcbiAgICB0cnkge1xuICAgICAgLy8gVE9ETyBhZGQgdmFsaWRhdGlvbiBvbiBjYXBzXG4gICAgICBsZXQgW3Nlc3Npb25JZCwgY2Fwc10gPSBhd2FpdCBzdXBlci5jcmVhdGVTZXNzaW9uKC4uLmFyZ3MpO1xuICAgICAgdGhpcy5vcHRzLnNlc3Npb25JZCA9IHNlc3Npb25JZDtcblxuICAgICAgYXdhaXQgdGhpcy5zdGFydCgpO1xuXG4gICAgICAvLyBtZXJnZSBzZXJ2ZXIgY2FwYWJpbGl0aWVzICsgZGVzaXJlZCBjYXBhYmlsaXRpZXNcbiAgICAgIGNhcHMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0U2VydmVyQ2FwcywgY2Fwcyk7XG4gICAgICAvLyB1cGRhdGUgdGhlIHVkaWQgd2l0aCB3aGF0IGlzIGFjdHVhbGx5IHVzZWRcbiAgICAgIGNhcHMudWRpZCA9IHRoaXMub3B0cy51ZGlkO1xuICAgICAgLy8gZW5zdXJlIHdlIHRyYWNrIG5hdGl2ZVdlYlRhcCBjYXBhYmlsaXR5IGFzIGEgc2V0dGluZyBhcyB3ZWxsXG4gICAgICBpZiAoXy5oYXModGhpcy5vcHRzLCAnbmF0aXZlV2ViVGFwJykpIHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVTZXR0aW5ncyh7bmF0aXZlV2ViVGFwOiB0aGlzLm9wdHMubmF0aXZlV2ViVGFwfSk7XG4gICAgICB9XG4gICAgICAvLyBlbnN1cmUgd2UgdHJhY2sgdXNlSlNPTlNvdXJjZSBjYXBhYmlsaXR5IGFzIGEgc2V0dGluZyBhcyB3ZWxsXG4gICAgICBpZiAoXy5oYXModGhpcy5vcHRzLCAndXNlSlNPTlNvdXJjZScpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlU2V0dGluZ3Moe3VzZUpTT05Tb3VyY2U6IHRoaXMub3B0cy51c2VKU09OU291cmNlfSk7XG4gICAgICB9XG5cbiAgICAgIGxldCB3ZGFTZXR0aW5ncyA9IHtcbiAgICAgICAgZWxlbWVudFJlc3BvbnNlQXR0cmlidXRlczogREVGQVVMVF9TRVRUSU5HUy5lbGVtZW50UmVzcG9uc2VBdHRyaWJ1dGVzLFxuICAgICAgICBzaG91bGRVc2VDb21wYWN0UmVzcG9uc2VzOiBERUZBVUxUX1NFVFRJTkdTLnNob3VsZFVzZUNvbXBhY3RSZXNwb25zZXMsXG4gICAgICB9O1xuICAgICAgaWYgKF8uaGFzKHRoaXMub3B0cywgJ2VsZW1lbnRSZXNwb25zZUF0dHJpYnV0ZXMnKSkge1xuICAgICAgICB3ZGFTZXR0aW5ncy5lbGVtZW50UmVzcG9uc2VBdHRyaWJ1dGVzID0gdGhpcy5vcHRzLmVsZW1lbnRSZXNwb25zZUF0dHJpYnV0ZXM7XG4gICAgICB9XG4gICAgICBpZiAoXy5oYXModGhpcy5vcHRzLCAnc2hvdWxkVXNlQ29tcGFjdFJlc3BvbnNlcycpKSB7XG4gICAgICAgIHdkYVNldHRpbmdzLnNob3VsZFVzZUNvbXBhY3RSZXNwb25zZXMgPSB0aGlzLm9wdHMuc2hvdWxkVXNlQ29tcGFjdFJlc3BvbnNlcztcbiAgICAgIH1cbiAgICAgIGlmIChfLmhhcyh0aGlzLm9wdHMsICdtanBlZ1NlcnZlclNjcmVlbnNob3RRdWFsaXR5JykpIHtcbiAgICAgICAgd2RhU2V0dGluZ3MubWpwZWdTZXJ2ZXJTY3JlZW5zaG90UXVhbGl0eSA9IHRoaXMub3B0cy5tanBlZ1NlcnZlclNjcmVlbnNob3RRdWFsaXR5O1xuICAgICAgfVxuICAgICAgaWYgKF8uaGFzKHRoaXMub3B0cywgJ21qcGVnU2VydmVyRnJhbWVyYXRlJykpIHtcbiAgICAgICAgd2RhU2V0dGluZ3MubWpwZWdTZXJ2ZXJGcmFtZXJhdGUgPSB0aGlzLm9wdHMubWpwZWdTZXJ2ZXJGcmFtZXJhdGU7XG4gICAgICB9XG4gICAgICBpZiAoXy5oYXModGhpcy5vcHRzLCAnc2NyZWVuc2hvdFF1YWxpdHknKSkge1xuICAgICAgICBsb2cuaW5mbyhgU2V0dGluZyB0aGUgcXVhbGl0eSBvZiBwaG9uZSBzY3JlZW5zaG90OiAnJHt0aGlzLm9wdHMuc2NyZWVuc2hvdFF1YWxpdHl9J2ApO1xuICAgICAgICB3ZGFTZXR0aW5ncy5zY3JlZW5zaG90UXVhbGl0eSA9IHRoaXMub3B0cy5zY3JlZW5zaG90UXVhbGl0eTtcbiAgICAgIH1cbiAgICAgIC8vIGVuc3VyZSBXREEgZ2V0cyBvdXIgZGVmYXVsdHMgaW5zdGVhZCBvZiB3aGF0ZXZlciBpdHMgb3duIG1pZ2h0IGJlXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVNldHRpbmdzKHdkYVNldHRpbmdzKTtcblxuICAgICAgLy8gdHVybiBvbiBtanBlZyBzdHJlYW0gcmVhZGluZyBpZiByZXF1ZXN0ZWRcbiAgICAgIGlmICh0aGlzLm9wdHMubWpwZWdTY3JlZW5zaG90VXJsKSB7XG4gICAgICAgIGxvZy5pbmZvKGBTdGFydGluZyBNSlBFRyBzdHJlYW0gcmVhZGluZyBVUkw6ICcke3RoaXMub3B0cy5tanBlZ1NjcmVlbnNob3RVcmx9J2ApO1xuICAgICAgICB0aGlzLm1qcGVnU3RyZWFtID0gbmV3IG1qcGVnLk1KcGVnU3RyZWFtKHRoaXMub3B0cy5tanBlZ1NjcmVlbnNob3RVcmwpO1xuICAgICAgICBhd2FpdCB0aGlzLm1qcGVnU3RyZWFtLnN0YXJ0KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gW3Nlc3Npb25JZCwgY2Fwc107XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmVycm9yKGUpO1xuICAgICAgYXdhaXQgdGhpcy5kZWxldGVTZXNzaW9uKCk7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN0YXJ0ICgpIHtcbiAgICB0aGlzLm9wdHMubm9SZXNldCA9ICEhdGhpcy5vcHRzLm5vUmVzZXQ7XG4gICAgdGhpcy5vcHRzLmZ1bGxSZXNldCA9ICEhdGhpcy5vcHRzLmZ1bGxSZXNldDtcblxuICAgIGF3YWl0IHByaW50VXNlcigpO1xuXG4gICAgdGhpcy5vcHRzLmlvc1Nka1ZlcnNpb24gPSBudWxsOyAvLyBGb3IgV0RBIGFuZCB4Y29kZWJ1aWxkXG4gICAgY29uc3Qge2RldmljZSwgdWRpZCwgcmVhbERldmljZX0gPSBhd2FpdCB0aGlzLmRldGVybWluZURldmljZSgpO1xuICAgIGxvZy5pbmZvKGBEZXRlcm1pbmluZyBkZXZpY2UgdG8gcnVuIHRlc3RzIG9uOiB1ZGlkOiAnJHt1ZGlkfScsIHJlYWwgZGV2aWNlOiAke3JlYWxEZXZpY2V9YCk7XG4gICAgdGhpcy5vcHRzLmRldmljZSA9IGRldmljZTtcbiAgICB0aGlzLm9wdHMudWRpZCA9IHVkaWQ7XG4gICAgdGhpcy5vcHRzLnJlYWxEZXZpY2UgPSByZWFsRGV2aWNlO1xuXG4gICAgY29uc3Qgbm9ybWFsaXplZFZlcnNpb24gPSBub3JtYWxpemVQbGF0Zm9ybVZlcnNpb24odGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbik7XG4gICAgaWYgKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24gIT09IG5vcm1hbGl6ZWRWZXJzaW9uKSB7XG4gICAgICBsb2cuaW5mbyhgTm9ybWFsaXplZCBwbGF0Zm9ybVZlcnNpb24gY2FwYWJpbGl0eSB2YWx1ZSAnJHt0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9ufScgdG8gJyR7bm9ybWFsaXplZFZlcnNpb259J2ApO1xuICAgICAgdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9IG5vcm1hbGl6ZWRWZXJzaW9uO1xuICAgIH1cbiAgICBpZiAodXRpbC5jb21wYXJlVmVyc2lvbnModGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiwgJzwnLCAnOS4zJykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGxhdGZvcm0gdmVyc2lvbiBtdXN0IGJlIDkuMyBvciBhYm92ZS4gJyR7dGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbn0nIGlzIG5vdCBzdXBwb3J0ZWQuYCk7XG4gICAgfVxuXG4gICAgaWYgKF8uaXNFbXB0eSh0aGlzLnhjb2RlVmVyc2lvbikgJiYgKCF0aGlzLm9wdHMud2ViRHJpdmVyQWdlbnRVcmwgfHwgIXRoaXMub3B0cy5yZWFsRGV2aWNlKSkge1xuICAgICAgLy8gbm8gYHdlYkRyaXZlckFnZW50VXJsYCwgb3Igb24gYSBzaW11bGF0b3IsIHNvIHdlIG5lZWQgYW4gWGNvZGUgdmVyc2lvblxuICAgICAgdGhpcy54Y29kZVZlcnNpb24gPSBhd2FpdCBnZXRBbmRDaGVja1hjb2RlVmVyc2lvbigpO1xuICAgIH1cbiAgICB0aGlzLmxvZ0V2ZW50KCd4Y29kZURldGFpbHNSZXRyaWV2ZWQnKTtcblxuICAgIGlmICh0aGlzLm9wdHMuZW5hYmxlQXN5bmNFeGVjdXRlRnJvbUh0dHBzICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAvLyBzaHV0ZG93biB0aGUgc2ltdWxhdG9yIHNvIHRoYXQgdGhlIHNzbCBjZXJ0IGlzIHJlY29nbml6ZWRcbiAgICAgIGF3YWl0IHNodXRkb3duU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UpO1xuICAgICAgYXdhaXQgdGhpcy5zdGFydEh0dHBzQXN5bmNTZXJ2ZXIoKTtcbiAgICB9XG5cbiAgICAvLyBhdCB0aGlzIHBvaW50IGlmIHRoZXJlIGlzIG5vIHBsYXRmb3JtVmVyc2lvbiwgZ2V0IGl0IGZyb20gdGhlIGRldmljZVxuICAgIGlmICghdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgaWYgKHRoaXMub3B0cy5kZXZpY2UgJiYgXy5pc0Z1bmN0aW9uKHRoaXMub3B0cy5kZXZpY2UuZ2V0UGxhdGZvcm1WZXJzaW9uKSkge1xuICAgICAgICB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uID0gYXdhaXQgdGhpcy5vcHRzLmRldmljZS5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICAgICAgbG9nLmluZm8oYE5vIHBsYXRmb3JtVmVyc2lvbiBzcGVjaWZpZWQuIFVzaW5nIGRldmljZSB2ZXJzaW9uOiAnJHt0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9ufSdgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFRPRE86IHRoaXMgaXMgd2hlbiBpdCBpcyBhIHJlYWwgZGV2aWNlLiB3aGVuIHdlIGhhdmUgYSByZWFsIG9iamVjdCB3aXJlIGl0IGluXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCh0aGlzLm9wdHMuYnJvd3Nlck5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09ICdzYWZhcmknKSB7XG4gICAgICBsb2cuaW5mbygnU2FmYXJpIHRlc3QgcmVxdWVzdGVkJyk7XG4gICAgICB0aGlzLnNhZmFyaSA9IHRydWU7XG4gICAgICB0aGlzLm9wdHMuYXBwID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5vcHRzLnByb2Nlc3NBcmd1bWVudHMgPSB0aGlzLm9wdHMucHJvY2Vzc0FyZ3VtZW50cyB8fCB7fTtcbiAgICAgIHRoaXMub3B0cy5idW5kbGVJZCA9IFNBRkFSSV9CVU5ETEVfSUQ7XG4gICAgICB0aGlzLl9jdXJyZW50VXJsID0gdGhpcy5vcHRzLnNhZmFyaUluaXRpYWxVcmwgfHwgKFxuICAgICAgICB0aGlzLmlzUmVhbERldmljZSgpXG4gICAgICAgICAgPyAnaHR0cDovL2FwcGl1bS5pbydcbiAgICAgICAgICA6IGBodHRwOi8vJHt0aGlzLm9wdHMuYWRkcmVzc306JHt0aGlzLm9wdHMucG9ydH0vd2VsY29tZWBcbiAgICAgICk7XG4gICAgICBpZiAodXRpbC5jb21wYXJlVmVyc2lvbnModGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiwgJzwnLCAnMTIuMicpKSB7XG4gICAgICAgIC8vIHRoaXMgb3B0aW9uIGRvZXMgbm90IHdvcmsgb24gMTIuMiBhbmQgYWJvdmVcbiAgICAgICAgdGhpcy5vcHRzLnByb2Nlc3NBcmd1bWVudHMuYXJncyA9IFsnLXUnLCB0aGlzLl9jdXJyZW50VXJsXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgdGhpcy5jb25maWd1cmVBcHAoKTtcbiAgICB9XG4gICAgdGhpcy5sb2dFdmVudCgnYXBwQ29uZmlndXJlZCcpO1xuXG4gICAgLy8gZmFpbCB2ZXJ5IGVhcmx5IGlmIHRoZSBhcHAgZG9lc24ndCBhY3R1YWxseSBleGlzdFxuICAgIC8vIG9yIGlmIGJ1bmRsZSBpZCBkb2Vzbid0IHBvaW50IHRvIGFuIGluc3RhbGxlZCBhcHBcbiAgICBpZiAodGhpcy5vcHRzLmFwcCkge1xuICAgICAgYXdhaXQgY2hlY2tBcHBQcmVzZW50KHRoaXMub3B0cy5hcHApO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSBhd2FpdCBhcHBVdGlscy5leHRyYWN0QnVuZGxlSWQodGhpcy5vcHRzLmFwcCk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5ydW5SZXNldCgpO1xuXG4gICAgY29uc3QgbWVtb2l6ZWRMb2dJbmZvID0gXy5tZW1vaXplKGZ1bmN0aW9uIGxvZ0luZm8gKCkge1xuICAgICAgbG9nLmluZm8oXCInc2tpcExvZ0NhcHR1cmUnIGlzIHNldC4gU2tpcHBpbmcgc3RhcnRpbmcgbG9ncyBzdWNoIGFzIGNyYXNoLCBzeXN0ZW0sIHNhZmFyaSBjb25zb2xlIGFuZCBzYWZhcmkgbmV0d29yay5cIik7XG4gICAgfSk7XG4gICAgY29uc3Qgc3RhcnRMb2dDYXB0dXJlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRoaXMub3B0cy5za2lwTG9nQ2FwdHVyZSkge1xuICAgICAgICBtZW1vaXplZExvZ0luZm8oKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnN0YXJ0TG9nQ2FwdHVyZSgpO1xuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICB0aGlzLmxvZ0V2ZW50KCdsb2dDYXB0dXJlU3RhcnRlZCcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xuICAgIGNvbnN0IGlzTG9nQ2FwdHVyZVN0YXJ0ZWQgPSBhd2FpdCBzdGFydExvZ0NhcHR1cmUoKTtcblxuICAgIGxvZy5pbmZvKGBTZXR0aW5nIHVwICR7dGhpcy5pc1JlYWxEZXZpY2UoKSA/ICdyZWFsIGRldmljZScgOiAnc2ltdWxhdG9yJ31gKTtcblxuICAgIGlmICh0aGlzLmlzU2ltdWxhdG9yKCkpIHtcbiAgICAgIGlmICh0aGlzLm9wdHMuc2h1dGRvd25PdGhlclNpbXVsYXRvcnMpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJlbGF4ZWRTZWN1cml0eUVuYWJsZWQpIHtcbiAgICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQXBwaXVtIHNlcnZlciBtdXN0IGhhdmUgcmVsYXhlZCBzZWN1cml0eSBmbGFnIHNldCBpbiBvcmRlciBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgZm9yICdzaHV0ZG93bk90aGVyU2ltdWxhdG9ycycgY2FwYWJpbGl0eSB0byB3b3JrYCk7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgc2h1dGRvd25PdGhlclNpbXVsYXRvcnModGhpcy5vcHRzLmRldmljZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHNldCByZWR1Y2VNb3Rpb24gaWYgY2FwYWJpbGl0eSBpcyBzZXRcbiAgICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5yZWR1Y2VNb3Rpb24pKSB7XG4gICAgICAgIGF3YWl0IHRoaXMub3B0cy5kZXZpY2Uuc2V0UmVkdWNlTW90aW9uKHRoaXMub3B0cy5yZWR1Y2VNb3Rpb24pO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvY2FsQ29uZmlnID0gYXdhaXQgaW9zU2V0dGluZ3Muc2V0TG9jYWxlQW5kUHJlZmVyZW5jZXModGhpcy5vcHRzLmRldmljZSwgdGhpcy5vcHRzLCB0aGlzLmlzU2FmYXJpKCksIGFzeW5jIChzaW0pID0+IHtcbiAgICAgICAgYXdhaXQgc2h1dGRvd25TaW11bGF0b3Ioc2ltKTtcblxuICAgICAgICAvLyB3ZSBkb24ndCBrbm93IGlmIHRoZXJlIG5lZWRzIHRvIGJlIGNoYW5nZXMgYSBwcmlvcmksIHNvIGNoYW5nZSBmaXJzdC5cbiAgICAgICAgLy8gc29tZXRpbWVzIHRoZSBzaHV0ZG93biBwcm9jZXNzIGNoYW5nZXMgdGhlIHNldHRpbmdzLCBzbyByZXNldCB0aGVtLFxuICAgICAgICAvLyBrbm93aW5nIHRoYXQgdGhlIHNpbSBpcyBhbHJlYWR5IHNodXRcbiAgICAgICAgYXdhaXQgaW9zU2V0dGluZ3Muc2V0TG9jYWxlQW5kUHJlZmVyZW5jZXMoc2ltLCB0aGlzLm9wdHMsIHRoaXMuaXNTYWZhcmkoKSk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgdGhpcy5zdGFydFNpbSgpO1xuXG4gICAgICBpZiAodGhpcy5vcHRzLmN1c3RvbVNTTENlcnQpIHtcbiAgICAgICAgaWYgKGF3YWl0IGhhc1NTTENlcnQodGhpcy5vcHRzLmN1c3RvbVNTTENlcnQsIHRoaXMub3B0cy51ZGlkKSkge1xuICAgICAgICAgIGxvZy5pbmZvKGBTU0wgY2VydCAnJHtfLnRydW5jYXRlKHRoaXMub3B0cy5jdXN0b21TU0xDZXJ0LCB7bGVuZ3RoOiAyMH0pfScgYWxyZWFkeSBpbnN0YWxsZWRgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsb2cuaW5mbyhgSW5zdGFsbGluZyBzc2wgY2VydCAnJHtfLnRydW5jYXRlKHRoaXMub3B0cy5jdXN0b21TU0xDZXJ0LCB7bGVuZ3RoOiAyMH0pfSdgKTtcbiAgICAgICAgICBhd2FpdCBzaHV0ZG93blNpbXVsYXRvcih0aGlzLm9wdHMuZGV2aWNlKTtcbiAgICAgICAgICBhd2FpdCBpbnN0YWxsU1NMQ2VydCh0aGlzLm9wdHMuY3VzdG9tU1NMQ2VydCwgdGhpcy5vcHRzLnVkaWQpO1xuICAgICAgICAgIGxvZy5pbmZvKGBSZXN0YXJ0aW5nIFNpbXVsYXRvciBzbyB0aGF0IFNTTCBjZXJ0aWZpY2F0ZSBpbnN0YWxsYXRpb24gdGFrZXMgZWZmZWN0YCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5zdGFydFNpbSgpO1xuICAgICAgICAgIHRoaXMubG9nRXZlbnQoJ2N1c3RvbUNlcnRJbnN0YWxsZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBpZGIgPSBuZXcgSURCKHt1ZGlkfSk7XG4gICAgICAgIGF3YWl0IGlkYi5jb25uZWN0KCk7XG4gICAgICAgIHRoaXMub3B0cy5kZXZpY2UuaWRiID0gaWRiO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBsb2cuaW5mbyhgaWRiIHdpbGwgbm90IGJlIHVzZWQgZm9yIFNpbXVsYXRvciBpbnRlcmFjdGlvbi4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvZ0V2ZW50KCdzaW1TdGFydGVkJyk7XG4gICAgICBpZiAoIWlzTG9nQ2FwdHVyZVN0YXJ0ZWQpIHtcbiAgICAgICAgLy8gUmV0cnkgbG9nIGNhcHR1cmUgaWYgU2ltdWxhdG9yIHdhcyBub3QgcnVubmluZyBiZWZvcmVcbiAgICAgICAgYXdhaXQgc3RhcnRMb2dDYXB0dXJlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0cy5hcHApIHtcbiAgICAgIGF3YWl0IHRoaXMuaW5zdGFsbEFVVCgpO1xuICAgICAgdGhpcy5sb2dFdmVudCgnYXBwSW5zdGFsbGVkJyk7XG4gICAgfVxuXG4gICAgLy8gaWYgd2Ugb25seSBoYXZlIGJ1bmRsZSBpZGVudGlmaWVyIGFuZCBubyBhcHAsIGZhaWwgaWYgaXQgaXMgbm90IGFscmVhZHkgaW5zdGFsbGVkXG4gICAgaWYgKCF0aGlzLm9wdHMuYXBwICYmIHRoaXMub3B0cy5idW5kbGVJZCAmJiAhdGhpcy5zYWZhcmkpIHtcbiAgICAgIGlmICghYXdhaXQgdGhpcy5vcHRzLmRldmljZS5pc0FwcEluc3RhbGxlZCh0aGlzLm9wdHMuYnVuZGxlSWQpKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBBcHAgd2l0aCBidW5kbGUgaWRlbnRpZmllciAnJHt0aGlzLm9wdHMuYnVuZGxlSWR9JyB1bmtub3duYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3B0cy5wZXJtaXNzaW9ucykge1xuICAgICAgaWYgKHRoaXMuaXNTaW11bGF0b3IoKSkge1xuICAgICAgICBsb2cuZGVidWcoJ1NldHRpbmcgdGhlIHJlcXVlc3RlZCBwZXJtaXNzaW9ucyBiZWZvcmUgV0RBIGlzIHN0YXJ0ZWQnKTtcbiAgICAgICAgZm9yIChjb25zdCBbYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZ10gb2YgXy50b1BhaXJzKEpTT04ucGFyc2UodGhpcy5vcHRzLnBlcm1pc3Npb25zKSkpIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLnNldFBlcm1pc3Npb25zKGJ1bmRsZUlkLCBwZXJtaXNzaW9uc01hcHBpbmcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cud2FybignU2V0dGluZyBwZXJtaXNzaW9ucyBpcyBvbmx5IHN1cHBvcnRlZCBvbiBTaW11bGF0b3IuICcgK1xuICAgICAgICAgICdUaGUgXCJwZXJtaXNzaW9uc1wiIGNhcGFiaWxpdHkgd2lsbCBiZSBpZ25vcmVkLicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc3RhcnRXZGEodGhpcy5vcHRzLnNlc3Npb25JZCwgcmVhbERldmljZSk7XG5cbiAgICBhd2FpdCB0aGlzLnNldEluaXRpYWxPcmllbnRhdGlvbih0aGlzLm9wdHMub3JpZW50YXRpb24pO1xuICAgIHRoaXMubG9nRXZlbnQoJ29yaWVudGF0aW9uU2V0Jyk7XG5cbiAgICAvLyByZWFsIGRldmljZXMgd2lsbCBiZSBoYW5kbGVkIGxhdGVyLCBhZnRlciB0aGUgd2ViIGNvbnRleHQgaGFzIGJlZW4gaW5pdGlhbGl6ZWRcbiAgICBpZiAodGhpcy5pc1NhZmFyaSgpICYmICF0aGlzLmlzUmVhbERldmljZSgpICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sICc+PScsICcxMi4yJykpIHtcbiAgICAgIC8vIG9uIDEyLjIgdGhlIHBhZ2UgaXMgbm90IG9wZW5lZCBpbiBXREFcbiAgICAgIGF3YWl0IG9wZW5VcmwodGhpcy5vcHRzLmRldmljZS51ZGlkLCB0aGlzLl9jdXJyZW50VXJsKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLm9wdHMuc3RhcnRJV0RQKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0SVdEUCgpO1xuICAgICAgICBsb2cuZGVidWcoYFN0YXJ0ZWQgaW9zX3dlYmtpdF9kZWJ1ZyBwcm94eSBzZXJ2ZXIgYXQ6ICR7dGhpcy5pd2RwU2VydmVyLmVuZHBvaW50fWApO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3Qgc3RhcnQgaW9zX3dlYmtpdF9kZWJ1Z19wcm94eSBzZXJ2ZXI6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNTYWZhcmkoKSB8fCB0aGlzLm9wdHMuYXV0b1dlYnZpZXcpIHtcbiAgICAgIGxvZy5kZWJ1ZygnV2FpdGluZyBmb3IgaW5pdGlhbCB3ZWJ2aWV3Jyk7XG4gICAgICBhd2FpdCB0aGlzLm5hdlRvSW5pdGlhbFdlYnZpZXcoKTtcbiAgICAgIHRoaXMubG9nRXZlbnQoJ2luaXRpYWxXZWJ2aWV3TmF2aWdhdGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNTYWZhcmkoKSAmJiB0aGlzLmlzUmVhbERldmljZSgpICYmIHV0aWwuY29tcGFyZVZlcnNpb25zKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sICc+PScsICcxMi4yJykpIHtcbiAgICAgIC8vIG9uIDEyLjIgdGhlIHBhZ2UgaXMgbm90IG9wZW5lZCBpbiBXREFcbiAgICAgIGF3YWl0IHRoaXMuc2V0VXJsKHRoaXMuX2N1cnJlbnRVcmwpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgaWYgKHRoaXMub3B0cy5jYWxlbmRhckFjY2Vzc0F1dGhvcml6ZWQpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5lbmFibGVDYWxlbmRhckFjY2Vzcyh0aGlzLm9wdHMuYnVuZGxlSWQpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuY2FsZW5kYXJBY2Nlc3NBdXRob3JpemVkID09PSBmYWxzZSkge1xuICAgICAgICBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmRpc2FibGVDYWxlbmRhckFjY2Vzcyh0aGlzLm9wdHMuYnVuZGxlSWQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCBXZWJEcml2ZXJBZ2VudFJ1bm5lclxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2Vzc2lvbklkIC0gVGhlIGlkIG9mIHRoZSB0YXJnZXQgc2Vzc2lvbiB0byBsYXVuY2ggV0RBIHdpdGguXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVhbERldmljZSAtIEVxdWFscyB0byB0cnVlIGlmIHRoZSB0ZXN0IHRhcmdldCBkZXZpY2UgaXMgYSByZWFsIGRldmljZS5cbiAgICovXG4gIGFzeW5jIHN0YXJ0V2RhIChzZXNzaW9uSWQsIHJlYWxEZXZpY2UpIHtcbiAgICB0aGlzLndkYSA9IG5ldyBXZWJEcml2ZXJBZ2VudCh0aGlzLnhjb2RlVmVyc2lvbiwgdGhpcy5vcHRzKTtcblxuICAgIC8vIERvbid0IGNsZWFudXAgdGhlIHByb2Nlc3NlcyBpZiB3ZWJEcml2ZXJBZ2VudFVybCBpcyBzZXRcbiAgICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy53ZGEud2ViRHJpdmVyQWdlbnRVcmwpKSB7XG4gICAgICBhd2FpdCB0aGlzLndkYS5jbGVhbnVwT2Jzb2xldGVQcm9jZXNzZXMoKTtcbiAgICB9XG4gICAgLy8gTGV0IG11bHRpcGxlIFdEQSBiaW5hcmllcyB3aXRoIGRpZmZlcmVudCBkZXJpdmVkIGRhdGEgZm9sZGVycyBiZSBidWlsdCBpbiBwYXJhbGxlbFxuICAgIC8vIENvbmN1cnJlbnQgV0RBIGJ1aWxkcyBmcm9tIHRoZSBzYW1lIHNvdXJjZSB3aWxsIGNhdXNlIHhjb2RlYnVpbGQgc3luY2hyb25pemF0aW9uIGVycm9yc1xuICAgIGNvbnN0IHN5bmNocm9uaXphdGlvbktleSA9ICF0aGlzLm9wdHMudXNlWGN0ZXN0cnVuRmlsZSAmJiBhd2FpdCB0aGlzLndkYS5pc1NvdXJjZUZyZXNoKClcbiAgICAgIC8vIEZpcnN0LXRpbWUgY29tcGlsYXRpb24gaXMgYW4gZXhwZW5zaXZlIG9wZXJhdGlvbiwgd2hpY2ggaXMgZG9uZSBmYXN0ZXIgaWYgZXhlY3V0ZWRcbiAgICAgIC8vIHNlcXVlbnRpYWxseS4gWGNvZGVidWlsZCBzcHJlYWRzIHRoZSBsb2FkIGNhdXNlZCBieSB0aGUgY2xhbmcgY29tcGlsZXIgdG8gYWxsIGF2YWlsYWJsZSBDUFUgY29yZXNcbiAgICAgID8gWENVSVRlc3REcml2ZXIubmFtZVxuICAgICAgOiBwYXRoLm5vcm1hbGl6ZShhd2FpdCB0aGlzLndkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpKTtcbiAgICBsb2cuZGVidWcoYFN0YXJ0aW5nIFdlYkRyaXZlckFnZW50IGluaXRpYWxpemF0aW9uIHdpdGggdGhlIHN5bmNocm9uaXphdGlvbiBrZXkgJyR7c3luY2hyb25pemF0aW9uS2V5fSdgKTtcbiAgICBpZiAoU0hBUkVEX1JFU09VUkNFU19HVUFSRC5pc0J1c3koKSAmJiAhdGhpcy5vcHRzLmRlcml2ZWREYXRhUGF0aCAmJiAhdGhpcy5vcHRzLmJvb3RzdHJhcFBhdGgpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgQ29uc2lkZXIgc2V0dGluZyBhIHVuaXF1ZSAnZGVyaXZlZERhdGFQYXRoJyBjYXBhYmlsaXR5IHZhbHVlIGZvciBlYWNoIHBhcmFsbGVsIGRyaXZlciBpbnN0YW5jZSBgICtcbiAgICAgICAgYHRvIGF2b2lkIGNvbmZsaWN0cyBhbmQgc3BlZWQgdXAgdGhlIGJ1aWxkaW5nIHByb2Nlc3NgKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IFNIQVJFRF9SRVNPVVJDRVNfR1VBUkQuYWNxdWlyZShzeW5jaHJvbml6YXRpb25LZXksIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICh0aGlzLm9wdHMudXNlTmV3V0RBKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgQ2FwYWJpbGl0eSAndXNlTmV3V0RBJyBzZXQgdG8gdHJ1ZSwgc28gdW5pbnN0YWxsaW5nIFdEQSBiZWZvcmUgcHJvY2VlZGluZ2ApO1xuICAgICAgICBhd2FpdCB0aGlzLndkYS5xdWl0QW5kVW5pbnN0YWxsKCk7XG4gICAgICAgIHRoaXMubG9nRXZlbnQoJ3dkYVVuaW5zdGFsbGVkJyk7XG4gICAgICB9IGVsc2UgaWYgKCF1dGlsLmhhc1ZhbHVlKHRoaXMud2RhLndlYkRyaXZlckFnZW50VXJsKSkge1xuICAgICAgICBhd2FpdCB0aGlzLndkYS5zZXR1cENhY2hpbmcodGhpcy5vcHRzLnVwZGF0ZWRXREFCdW5kbGVJZCk7XG4gICAgICB9XG5cbiAgICAgIC8vIGxvY2FsIGhlbHBlciBmb3IgdGhlIHR3byBwbGFjZXMgd2UgbmVlZCB0byB1bmluc3RhbGwgd2RhIGFuZCByZS1zdGFydCBpdFxuICAgICAgY29uc3QgcXVpdEFuZFVuaW5zdGFsbCA9IGFzeW5jIChtc2cpID0+IHtcbiAgICAgICAgbG9nLmRlYnVnKG1zZyk7XG4gICAgICAgIGlmICh0aGlzLm9wdHMud2ViRHJpdmVyQWdlbnRVcmwpIHtcbiAgICAgICAgICBsb2cuZGVidWcoJ05vdCBxdWl0dGluZy91bmluc3RhbGxpbmcgV2ViRHJpdmVyQWdlbnQgc2luY2Ugd2ViRHJpdmVyQWdlbnRVcmwgY2FwYWJpbGl0eSBpcyBwcm92aWRlZCcpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgICB9XG4gICAgICAgIGxvZy53YXJuKCdRdWl0dGluZyBhbmQgdW5pbnN0YWxsaW5nIFdlYkRyaXZlckFnZW50Jyk7XG4gICAgICAgIGF3YWl0IHRoaXMud2RhLnF1aXRBbmRVbmluc3RhbGwoKTtcblxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobXNnKTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHN0YXJ0dXBSZXRyaWVzID0gdGhpcy5vcHRzLndkYVN0YXJ0dXBSZXRyaWVzIHx8ICh0aGlzLmlzUmVhbERldmljZSgpID8gV0RBX1JFQUxfREVWX1NUQVJUVVBfUkVUUklFUyA6IFdEQV9TSU1fU1RBUlRVUF9SRVRSSUVTKTtcbiAgICAgIGNvbnN0IHN0YXJ0dXBSZXRyeUludGVydmFsID0gdGhpcy5vcHRzLndkYVN0YXJ0dXBSZXRyeUludGVydmFsIHx8IFdEQV9TVEFSVFVQX1JFVFJZX0lOVEVSVkFMO1xuICAgICAgbG9nLmRlYnVnKGBUcnlpbmcgdG8gc3RhcnQgV2ViRHJpdmVyQWdlbnQgJHtzdGFydHVwUmV0cmllc30gdGltZXMgd2l0aCAke3N0YXJ0dXBSZXRyeUludGVydmFsfW1zIGludGVydmFsYCk7XG4gICAgICBpZiAoIXV0aWwuaGFzVmFsdWUodGhpcy5vcHRzLndkYVN0YXJ0dXBSZXRyaWVzKSAmJiAhdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMud2RhU3RhcnR1cFJldHJ5SW50ZXJ2YWwpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgVGhlc2UgdmFsdWVzIGNhbiBiZSBjdXN0b21pemVkIGJ5IGNoYW5naW5nIHdkYVN0YXJ0dXBSZXRyaWVzL3dkYVN0YXJ0dXBSZXRyeUludGVydmFsIGNhcGFiaWxpdGllc2ApO1xuICAgICAgfVxuICAgICAgbGV0IHJldHJ5Q291bnQgPSAwO1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbChzdGFydHVwUmV0cmllcywgc3RhcnR1cFJldHJ5SW50ZXJ2YWwsIGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dFdmVudCgnd2RhU3RhcnRBdHRlbXB0ZWQnKTtcbiAgICAgICAgaWYgKHJldHJ5Q291bnQgPiAwKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFJldHJ5aW5nIFdEQSBzdGFydHVwICgke3JldHJ5Q291bnQgKyAxfSBvZiAke3N0YXJ0dXBSZXRyaWVzfSlgKTtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIG9uIHhjb2RlIDEwIGluc3RhbGxkIHdpbGwgb2Z0ZW4gdHJ5IHRvIGFjY2VzcyB0aGUgYXBwIGZyb20gaXRzIHN0YWdpbmdcbiAgICAgICAgICAvLyBkaXJlY3RvcnkgYmVmb3JlIGZ1bGx5IG1vdmluZyBpdCB0aGVyZSwgYW5kIGZhaWwuIFJldHJ5aW5nIG9uY2VcbiAgICAgICAgICAvLyBpbW1lZGlhdGVseSBoZWxwc1xuICAgICAgICAgIGNvbnN0IHJldHJpZXMgPSB0aGlzLnhjb2RlVmVyc2lvbi5tYWpvciA+PSAxMCA/IDIgOiAxO1xuICAgICAgICAgIHRoaXMuY2FjaGVkV2RhU3RhdHVzID0gYXdhaXQgcmV0cnkocmV0cmllcywgdGhpcy53ZGEubGF1bmNoLmJpbmQodGhpcy53ZGEpLCBzZXNzaW9uSWQsIHJlYWxEZXZpY2UpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICB0aGlzLmxvZ0V2ZW50KCd3ZGFTdGFydEZhaWxlZCcpO1xuICAgICAgICAgIHJldHJ5Q291bnQrKztcbiAgICAgICAgICBsZXQgZXJyb3JNc2cgPSBgVW5hYmxlIHRvIGxhdW5jaCBXZWJEcml2ZXJBZ2VudCBiZWNhdXNlIG9mIHhjb2RlYnVpbGQgZmFpbHVyZTogJHtlcnIubWVzc2FnZX1gO1xuICAgICAgICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAgICAgICBlcnJvck1zZyArPSBgLiBNYWtlIHN1cmUgeW91IGZvbGxvdyB0aGUgdHV0b3JpYWwgYXQgJHtXREFfUkVBTF9ERVZfVFVUT1JJQUxfVVJMfS4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgVHJ5IHRvIHJlbW92ZSB0aGUgV2ViRHJpdmVyQWdlbnRSdW5uZXIgYXBwbGljYXRpb24gZnJvbSB0aGUgZGV2aWNlIGlmIGl0IGlzIGluc3RhbGxlZCBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBhbmQgcmVib290IHRoZSBkZXZpY2UuYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYXdhaXQgcXVpdEFuZFVuaW5zdGFsbChlcnJvck1zZyk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnByb3h5UmVxUmVzID0gdGhpcy53ZGEucHJveHlSZXFSZXMuYmluZCh0aGlzLndkYSk7XG4gICAgICAgIHRoaXMuandwUHJveHlBY3RpdmUgPSB0cnVlO1xuXG4gICAgICAgIGxldCBvcmlnaW5hbFN0YWNrdHJhY2UgPSBudWxsO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwoMTUsIDEwMDAsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nRXZlbnQoJ3dkYVNlc3Npb25BdHRlbXB0ZWQnKTtcbiAgICAgICAgICAgIGxvZy5kZWJ1ZygnU2VuZGluZyBjcmVhdGVTZXNzaW9uIGNvbW1hbmQgdG8gV0RBJyk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICB0aGlzLmNhY2hlZFdkYVN0YXR1cyA9IHRoaXMuY2FjaGVkV2RhU3RhdHVzIHx8IGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvc3RhdHVzJywgJ0dFVCcpO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnN0YXJ0V2RhU2Vzc2lvbih0aGlzLm9wdHMuYnVuZGxlSWQsIHRoaXMub3B0cy5wcm9jZXNzQXJndW1lbnRzKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBvcmlnaW5hbFN0YWNrdHJhY2UgPSBlcnIuc3RhY2s7XG4gICAgICAgICAgICAgIGxvZy5kZWJ1ZyhgRmFpbGVkIHRvIGNyZWF0ZSBXREEgc2Vzc2lvbiAoJHtlcnIubWVzc2FnZX0pLiBSZXRyeWluZy4uLmApO1xuICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5sb2dFdmVudCgnd2RhU2Vzc2lvblN0YXJ0ZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgaWYgKG9yaWdpbmFsU3RhY2t0cmFjZSkge1xuICAgICAgICAgICAgbG9nLmRlYnVnKG9yaWdpbmFsU3RhY2t0cmFjZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCBlcnJvck1zZyA9IGBVbmFibGUgdG8gc3RhcnQgV2ViRHJpdmVyQWdlbnQgc2Vzc2lvbiBiZWNhdXNlIG9mIHhjb2RlYnVpbGQgZmFpbHVyZTogJHtlcnIubWVzc2FnZX1gO1xuICAgICAgICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICAgICAgICBlcnJvck1zZyArPSBgIE1ha2Ugc3VyZSB5b3UgZm9sbG93IHRoZSB0dXRvcmlhbCBhdCAke1dEQV9SRUFMX0RFVl9UVVRPUklBTF9VUkx9LiBgICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGBUcnkgdG8gcmVtb3ZlIHRoZSBXZWJEcml2ZXJBZ2VudFJ1bm5lciBhcHBsaWNhdGlvbiBmcm9tIHRoZSBkZXZpY2UgaWYgaXQgaXMgaW5zdGFsbGVkIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgYGFuZCByZWJvb3QgdGhlIGRldmljZS5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhd2FpdCBxdWl0QW5kVW5pbnN0YWxsKGVycm9yTXNnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdHMuY2xlYXJTeXN0ZW1GaWxlcyAmJiAhdGhpcy5vcHRzLndlYkRyaXZlckFnZW50VXJsKSB7XG4gICAgICAgICAgYXdhaXQgbWFya1N5c3RlbUZpbGVzRm9yQ2xlYW51cCh0aGlzLndkYSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB3ZSBleHBlY3QgY2VydGFpbiBzb2NrZXQgZXJyb3JzIHVudGlsIHRoaXMgcG9pbnQsIGJ1dCBub3dcbiAgICAgICAgLy8gbWFyayB0aGluZ3MgYXMgZnVsbHkgd29ya2luZ1xuICAgICAgICB0aGlzLndkYS5mdWxseVN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmxvZ0V2ZW50KCd3ZGFTdGFydGVkJyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHJ1blJlc2V0IChvcHRzID0gbnVsbCkge1xuICAgIHRoaXMubG9nRXZlbnQoJ3Jlc2V0U3RhcnRlZCcpO1xuICAgIGlmICh0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgICBhd2FpdCBydW5SZWFsRGV2aWNlUmVzZXQodGhpcy5vcHRzLmRldmljZSwgb3B0cyB8fCB0aGlzLm9wdHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhd2FpdCBydW5TaW11bGF0b3JSZXNldCh0aGlzLm9wdHMuZGV2aWNlLCBvcHRzIHx8IHRoaXMub3B0cyk7XG4gICAgfVxuICAgIHRoaXMubG9nRXZlbnQoJ3Jlc2V0Q29tcGxldGUnKTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZVNlc3Npb24gKCkge1xuICAgIGF3YWl0IHJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyh0aGlzLnNlcnZlciwgdGhpcy5zZXNzaW9uSWQpO1xuXG4gICAgaWYgKHRoaXMuaXNTaW11bGF0b3IoKSAmJiAodGhpcy5vcHRzLmRldmljZSB8fCB7fSkuaWRiKSB7XG4gICAgICBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmlkYi5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLm9wdHMuZGV2aWNlLmlkYiA9IG51bGw7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5zdG9wKCk7XG5cbiAgICBpZiAodGhpcy5vcHRzLmNsZWFyU3lzdGVtRmlsZXMgJiYgdGhpcy5pc0FwcFRlbXBvcmFyeSkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMub3B0cy5hcHApO1xuICAgIH1cblxuICAgIGlmICh0aGlzLndkYSAmJiAhdGhpcy5vcHRzLndlYkRyaXZlckFnZW50VXJsKSB7XG4gICAgICBjb25zdCBzeW5jaHJvbml6YXRpb25LZXkgPSBwYXRoLm5vcm1hbGl6ZShhd2FpdCB0aGlzLndkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpKTtcbiAgICAgIGF3YWl0IFNIQVJFRF9SRVNPVVJDRVNfR1VBUkQuYWNxdWlyZShzeW5jaHJvbml6YXRpb25LZXksIGFzeW5jICgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMub3B0cy5jbGVhclN5c3RlbUZpbGVzKSB7XG4gICAgICAgICAgYXdhaXQgY2xlYXJTeXN0ZW1GaWxlcyh0aGlzLndkYSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbG9nLmRlYnVnKCdOb3QgY2xlYXJpbmcgbG9nIGZpbGVzLiBVc2UgYGNsZWFyU3lzdGVtRmlsZXNgIGNhcGFiaWxpdHkgdG8gdHVybiBvbi4nKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICAgIGxvZy5kZWJ1ZygnSW4gYSB3ZWIgc2Vzc2lvbi4gUmVtb3ZpbmcgcmVtb3RlIGRlYnVnZ2VyJyk7XG4gICAgICBhd2FpdCB0aGlzLnN0b3BSZW1vdGUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRzLnJlc2V0T25TZXNzaW9uU3RhcnRPbmx5ID09PSBmYWxzZSkge1xuICAgICAgYXdhaXQgdGhpcy5ydW5SZXNldChPYmplY3QuYXNzaWduKHt9LCB0aGlzLm9wdHMsIHtcbiAgICAgICAgZW5mb3JjZVNpbXVsYXRvclNodXRkb3duOiB0cnVlLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzU2ltdWxhdG9yKCkgJiYgIXRoaXMub3B0cy5ub1Jlc2V0ICYmICEhdGhpcy5vcHRzLmRldmljZSkge1xuICAgICAgaWYgKHRoaXMubGlmZWN5Y2xlRGF0YS5jcmVhdGVTaW0pIHtcbiAgICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBzaW11bGF0b3IgY3JlYXRlZCBmb3IgdGhpcyBydW4gKHVkaWQ6ICcke3RoaXMub3B0cy51ZGlkfScpYCk7XG4gICAgICAgIGF3YWl0IHNodXRkb3duU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UpO1xuICAgICAgICBhd2FpdCB0aGlzLm9wdHMuZGV2aWNlLmRlbGV0ZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghXy5pc0VtcHR5KHRoaXMubG9ncykpIHtcbiAgICAgIGF3YWl0IHRoaXMubG9ncy5zeXNsb2cuc3RvcENhcHR1cmUoKTtcbiAgICAgIHRoaXMubG9ncyA9IHt9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLml3ZHBTZXJ2ZXIpIHtcbiAgICAgIGF3YWl0IHRoaXMuc3RvcElXRFAoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRzLmVuYWJsZUFzeW5jRXhlY3V0ZUZyb21IdHRwcyAmJiAhdGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgdGhpcy5zdG9wSHR0cHNBc3luY1NlcnZlcigpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm1qcGVnU3RyZWFtKSB7XG4gICAgICBsb2cuaW5mbygnQ2xvc2luZyBNSlBFRyBzdHJlYW0nKTtcbiAgICAgIHRoaXMubWpwZWdTdHJlYW0uc3RvcCgpO1xuICAgIH1cblxuICAgIHRoaXMucmVzZXRJb3MoKTtcblxuICAgIGF3YWl0IHN1cGVyLmRlbGV0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIGFzeW5jIHN0b3AgKCkge1xuICAgIHRoaXMuandwUHJveHlBY3RpdmUgPSBmYWxzZTtcbiAgICB0aGlzLnByb3h5UmVxUmVzID0gbnVsbDtcblxuICAgIGlmICh0aGlzLndkYSAmJiB0aGlzLndkYS5mdWxseVN0YXJ0ZWQpIHtcbiAgICAgIGlmICh0aGlzLndkYS5qd3Byb3h5KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoYC9zZXNzaW9uLyR7dGhpcy5zZXNzaW9uSWR9YCwgJ0RFTEVURScpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBhbiBlcnJvciBoZXJlIHNob3VsZCBub3Qgc2hvcnQtY2lyY3VpdCB0aGUgcmVzdCBvZiBjbGVhbiB1cFxuICAgICAgICAgIGxvZy5kZWJ1ZyhgVW5hYmxlIHRvIERFTEVURSBzZXNzaW9uIG9uIFdEQTogJyR7ZXJyLm1lc3NhZ2V9Jy4gQ29udGludWluZyBzaHV0ZG93bi5gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMud2RhICYmICF0aGlzLndkYS53ZWJEcml2ZXJBZ2VudFVybCAmJiB0aGlzLm9wdHMudXNlTmV3V0RBKSB7XG4gICAgICAgIGF3YWl0IHRoaXMud2RhLnF1aXQoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY21kLCAuLi5hcmdzKSB7XG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgY29tbWFuZCAnJHtjbWR9J2ApO1xuXG4gICAgaWYgKGNtZCA9PT0gJ3JlY2VpdmVBc3luY1Jlc3BvbnNlJykge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMucmVjZWl2ZUFzeW5jUmVzcG9uc2UoLi4uYXJncyk7XG4gICAgfVxuICAgIC8vIFRPRE86IG9uY2UgdGhpcyBmaXggZ2V0cyBpbnRvIGJhc2UgZHJpdmVyIHJlbW92ZSBmcm9tIGhlcmVcbiAgICBpZiAoY21kID09PSAnZ2V0U3RhdHVzJykge1xuICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0U3RhdHVzKCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCBzdXBlci5leGVjdXRlQ29tbWFuZChjbWQsIC4uLmFyZ3MpO1xuICB9XG5cbiAgYXN5bmMgY29uZmlndXJlQXBwICgpIHtcbiAgICBmdW5jdGlvbiBhcHBJc1BhY2thZ2VPckJ1bmRsZSAoYXBwKSB7XG4gICAgICByZXR1cm4gKC9eKFthLXpBLVowLTlcXC1fXStcXC5bYS16QS1aMC05XFwtX10rKSskLykudGVzdChhcHApO1xuICAgIH1cblxuICAgIC8vIHRoZSBhcHAgbmFtZSBpcyBhIGJ1bmRsZUlkIGFzc2lnbiBpdCB0byB0aGUgYnVuZGxlSWQgcHJvcGVydHlcbiAgICBpZiAoIXRoaXMub3B0cy5idW5kbGVJZCAmJiBhcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYXBwKSkge1xuICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gdGhpcy5vcHRzLmFwcDtcbiAgICAgIHRoaXMub3B0cy5hcHAgPSAnJztcbiAgICB9XG4gICAgLy8gd2UgaGF2ZSBhIGJ1bmRsZSBJRCwgYnV0IG5vIGFwcCwgb3IgYXBwIGlzIGFsc28gYSBidW5kbGVcbiAgICBpZiAoKHRoaXMub3B0cy5idW5kbGVJZCAmJiBhcHBJc1BhY2thZ2VPckJ1bmRsZSh0aGlzLm9wdHMuYnVuZGxlSWQpKSAmJlxuICAgICAgICAodGhpcy5vcHRzLmFwcCA9PT0gJycgfHwgYXBwSXNQYWNrYWdlT3JCdW5kbGUodGhpcy5vcHRzLmFwcCkpKSB7XG4gICAgICBsb2cuZGVidWcoJ0FwcCBpcyBhbiBpT1MgYnVuZGxlLCB3aWxsIGF0dGVtcHQgdG8gcnVuIGFzIHByZS1leGlzdGluZycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGZvciBzdXBwb3J0ZWQgYnVpbGQtaW4gYXBwc1xuICAgIGlmICh0aGlzLm9wdHMuYXBwICYmIHRoaXMub3B0cy5hcHAudG9Mb3dlckNhc2UoKSA9PT0gJ3NldHRpbmdzJykge1xuICAgICAgdGhpcy5vcHRzLmJ1bmRsZUlkID0gJ2NvbS5hcHBsZS5QcmVmZXJlbmNlcyc7XG4gICAgICB0aGlzLm9wdHMuYXBwID0gbnVsbDtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKHRoaXMub3B0cy5hcHAgJiYgdGhpcy5vcHRzLmFwcC50b0xvd2VyQ2FzZSgpID09PSAnY2FsZW5kYXInKSB7XG4gICAgICB0aGlzLm9wdHMuYnVuZGxlSWQgPSAnY29tLmFwcGxlLm1vYmlsZWNhbCc7XG4gICAgICB0aGlzLm9wdHMuYXBwID0gbnVsbDtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBvcmlnaW5hbEFwcFBhdGggPSB0aGlzLm9wdHMuYXBwO1xuICAgIHRyeSB7XG4gICAgICAvLyBkb3dubG9hZCBpZiBuZWNlc3NhcnlcbiAgICAgIHRoaXMub3B0cy5hcHAgPSBhd2FpdCB0aGlzLmhlbHBlcnMuY29uZmlndXJlQXBwKHRoaXMub3B0cy5hcHAsICcuYXBwJyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZXJyb3IoZXJyKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQmFkIGFwcDogJHt0aGlzLm9wdHMuYXBwfS4gQXBwIHBhdGhzIG5lZWQgdG8gYmUgYWJzb2x1dGUgb3IgYW4gVVJMIHRvIGEgY29tcHJlc3NlZCBhcHAgZmlsZSR7ZXJyICYmIGVyci5tZXNzYWdlID8gYDogJHtlcnIubWVzc2FnZX1gIDogJyd9YCk7XG4gICAgfVxuICAgIHRoaXMuaXNBcHBUZW1wb3JhcnkgPSB0aGlzLm9wdHMuYXBwICYmIGF3YWl0IGZzLmV4aXN0cyh0aGlzLm9wdHMuYXBwKVxuICAgICAgJiYgIWF3YWl0IHV0aWwuaXNTYW1lRGVzdGluYXRpb24ob3JpZ2luYWxBcHBQYXRoLCB0aGlzLm9wdHMuYXBwKTtcbiAgfVxuXG4gIGFzeW5jIGRldGVybWluZURldmljZSAoKSB7XG4gICAgLy8gaW4gdGhlIG9uZSBjYXNlIHdoZXJlIHdlIGNyZWF0ZSBhIHNpbSwgd2Ugd2lsbCBzZXQgdGhpcyBzdGF0ZVxuICAgIHRoaXMubGlmZWN5Y2xlRGF0YS5jcmVhdGVTaW0gPSBmYWxzZTtcblxuICAgIC8vIGlmIHdlIGdldCBnZW5lcmljIG5hbWVzLCB0cmFuc2xhdGUgdGhlbVxuICAgIHRoaXMub3B0cy5kZXZpY2VOYW1lID0gdHJhbnNsYXRlRGV2aWNlTmFtZSh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLCB0aGlzLm9wdHMuZGV2aWNlTmFtZSk7XG5cbiAgICBjb25zdCBzZXR1cFZlcnNpb25DYXBzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdGhpcy5vcHRzLmlvc1Nka1ZlcnNpb24gPSBhd2FpdCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24oKTtcbiAgICAgIGxvZy5pbmZvKGBpT1MgU0RLIFZlcnNpb24gc2V0IHRvICcke3RoaXMub3B0cy5pb3NTZGtWZXJzaW9ufSdgKTtcbiAgICAgIGlmICghdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiAmJiB0aGlzLm9wdHMuaW9zU2RrVmVyc2lvbikge1xuICAgICAgICBsb2cuaW5mbyhgTm8gcGxhdGZvcm1WZXJzaW9uIHNwZWNpZmllZC4gVXNpbmcgdGhlIGxhdGVzdCB2ZXJzaW9uIFhjb2RlIHN1cHBvcnRzOiAnJHt0aGlzLm9wdHMuaW9zU2RrVmVyc2lvbn0nLiBgICtcbiAgICAgICAgICBgVGhpcyBtYXkgY2F1c2UgcHJvYmxlbXMgaWYgYSBzaW11bGF0b3IgZG9lcyBub3QgZXhpc3QgZm9yIHRoaXMgcGxhdGZvcm0gdmVyc2lvbi5gKTtcbiAgICAgICAgdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9IG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbih0aGlzLm9wdHMuaW9zU2RrVmVyc2lvbik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmICh0aGlzLm9wdHMudWRpZCkge1xuICAgICAgaWYgKHRoaXMub3B0cy51ZGlkLnRvTG93ZXJDYXNlKCkgPT09ICdhdXRvJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMub3B0cy51ZGlkID0gYXdhaXQgZGV0ZWN0VWRpZCgpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAvLyBUcnlpbmcgdG8gZmluZCBtYXRjaGluZyBVRElEIGZvciBTaW11bGF0b3JcbiAgICAgICAgICBsb2cud2FybihgQ2Fubm90IGRldGVjdCBhbnkgY29ubmVjdGVkIHJlYWwgZGV2aWNlcy4gRmFsbGluZyBiYWNrIHRvIFNpbXVsYXRvci4gT3JpZ2luYWwgZXJyb3I6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgY29uc3QgZGV2aWNlID0gYXdhaXQgZ2V0RXhpc3RpbmdTaW0odGhpcy5vcHRzKTtcbiAgICAgICAgICBpZiAoIWRldmljZSkge1xuICAgICAgICAgICAgLy8gTm8gbWF0Y2hpbmcgU2ltdWxhdG9yIGlzIGZvdW5kLiBUaHJvdyBhbiBlcnJvclxuICAgICAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYENhbm5vdCBkZXRlY3QgdWRpZCBmb3IgJHt0aGlzLm9wdHMuZGV2aWNlTmFtZX0gU2ltdWxhdG9yIHJ1bm5pbmcgaU9TICR7dGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbn1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBNYXRjaGluZyBTaW11bGF0b3IgZXhpc3RzIGFuZCBpcyBmb3VuZC4gVXNlIGl0XG4gICAgICAgICAgdGhpcy5vcHRzLnVkaWQgPSBkZXZpY2UudWRpZDtcbiAgICAgICAgICBjb25zdCBkZXZpY2VQbGF0Zm9ybSA9IG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbihhd2FpdCBkZXZpY2UuZ2V0UGxhdGZvcm1WZXJzaW9uKCkpO1xuICAgICAgICAgIGlmICh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uICE9PSBkZXZpY2VQbGF0Zm9ybSkge1xuICAgICAgICAgICAgdGhpcy5vcHRzLnBsYXRmb3JtVmVyc2lvbiA9IGRldmljZVBsYXRmb3JtO1xuICAgICAgICAgICAgbG9nLmluZm8oYFNldCBwbGF0Zm9ybVZlcnNpb24gdG8gJyR7ZGV2aWNlUGxhdGZvcm19JyB0byBtYXRjaCB0aGUgZGV2aWNlIHdpdGggZ2l2ZW4gVURJRGApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBhd2FpdCBzZXR1cFZlcnNpb25DYXBzKCk7XG4gICAgICAgICAgcmV0dXJuIHtkZXZpY2UsIHJlYWxEZXZpY2U6IGZhbHNlLCB1ZGlkOiBkZXZpY2UudWRpZH07XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG1ha2Ugc3VyZSBpdCBpcyBhIGNvbm5lY3RlZCBkZXZpY2UuIElmIG5vdCwgdGhlIHVkaWQgcGFzc2VkIGluIGlzIGludmFsaWRcbiAgICAgICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IGdldENvbm5lY3RlZERldmljZXMoKTtcbiAgICAgICAgbG9nLmRlYnVnKGBBdmFpbGFibGUgZGV2aWNlczogJHtkZXZpY2VzLmpvaW4oJywgJyl9YCk7XG4gICAgICAgIGlmICghZGV2aWNlcy5pbmNsdWRlcyh0aGlzLm9wdHMudWRpZCkpIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgYSBwYXJ0aWN1bGFyIHNpbXVsYXRvclxuICAgICAgICAgIGlmIChhd2FpdCBzaW1FeGlzdHModGhpcy5vcHRzLnVkaWQpKSB7XG4gICAgICAgICAgICBjb25zdCBkZXZpY2UgPSBhd2FpdCBnZXRTaW11bGF0b3IodGhpcy5vcHRzLnVkaWQpO1xuICAgICAgICAgICAgcmV0dXJuIHtkZXZpY2UsIHJlYWxEZXZpY2U6IGZhbHNlLCB1ZGlkOiB0aGlzLm9wdHMudWRpZH07XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGRldmljZSBvciBzaW11bGF0b3IgVURJRDogJyR7dGhpcy5vcHRzLnVkaWR9J2ApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRldmljZSA9IGF3YWl0IGdldFJlYWxEZXZpY2VPYmoodGhpcy5vcHRzLnVkaWQpO1xuICAgICAgaWYgKF8uaXNFbXB0eSh0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uKSkge1xuICAgICAgICBsb2cuaW5mbygnVHJ5aW5nIHRvIGRldGVybWluZSBwbGF0Zm9ybVZlcnNpb24gZnJvbSBpZGV2aWNlaW5mbyBvdXRwdXQnKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2lkZXZpY2VpbmZvJywgW1xuICAgICAgICAgICAgJy11JywgdGhpcy5vcHRzLnVkaWQsXG4gICAgICAgICAgICAnLXMnLFxuICAgICAgICAgICAgJy1rJywgJ1Byb2R1Y3RWZXJzaW9uJyxcbiAgICAgICAgICBdKTtcbiAgICAgICAgICB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uID0gdXRpbC5jb2VyY2VWZXJzaW9uKHN0ZG91dC50cmltKCksIGZhbHNlKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGxvZy53YXJuKGBDYW5ub3QgZGV0ZXJtaW5lIHJlYWwgZGV2aWNlIHBsYXRmb3JtIHZlcnNpb24uIE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHtkZXZpY2UsIHJlYWxEZXZpY2U6IHRydWUsIHVkaWQ6IHRoaXMub3B0cy51ZGlkfTtcbiAgICB9XG5cbiAgICAvLyBOb3cgd2Uga25vdyBmb3Igc3VyZSB0aGUgZGV2aWNlIHdpbGwgYmUgYSBTaW11bGF0b3JcbiAgICBhd2FpdCBzZXR1cFZlcnNpb25DYXBzKCk7XG4gICAgaWYgKHRoaXMub3B0cy5lbmZvcmNlRnJlc2hTaW11bGF0b3JDcmVhdGlvbikge1xuICAgICAgbG9nLmRlYnVnKGBOZXcgc2ltdWxhdG9yIGlzIHJlcXVlc3RlZC4gSWYgdGhpcyBpcyBub3Qgd2FudGVkLCBzZXQgJ2VuZm9yY2VGcmVzaFNpbXVsYXRvckNyZWF0aW9uJyBjYXBhYmlsaXR5IHRvIGZhbHNlYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGZpZ3VyZSBvdXQgdGhlIGNvcnJlY3Qgc2ltdWxhdG9yIHRvIHVzZSwgZ2l2ZW4gdGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzXG4gICAgICBjb25zdCBkZXZpY2UgPSBhd2FpdCBnZXRFeGlzdGluZ1NpbSh0aGlzLm9wdHMpO1xuXG4gICAgICAvLyBjaGVjayBmb3IgYW4gZXhpc3Rpbmcgc2ltdWxhdG9yXG4gICAgICBpZiAoZGV2aWNlKSB7XG4gICAgICAgIHJldHVybiB7ZGV2aWNlLCByZWFsRGV2aWNlOiBmYWxzZSwgdWRpZDogZGV2aWNlLnVkaWR9O1xuICAgICAgfVxuXG4gICAgICBsb2cuaW5mbygnU2ltdWxhdG9yIHVkaWQgbm90IHByb3ZpZGVkJyk7XG4gICAgfVxuXG4gICAgLy8gbm8gZGV2aWNlIG9mIHRoaXMgdHlwZSBleGlzdHMsIG9yIHRoZXkgcmVxdWVzdCBuZXcgc2ltLCBzbyBjcmVhdGUgb25lXG4gICAgbG9nLmluZm8oJ1VzaW5nIGRlc2lyZWQgY2FwcyB0byBjcmVhdGUgYSBuZXcgc2ltdWxhdG9yJyk7XG4gICAgY29uc3QgZGV2aWNlID0gYXdhaXQgdGhpcy5jcmVhdGVTaW0oKTtcbiAgICByZXR1cm4ge2RldmljZSwgcmVhbERldmljZTogZmFsc2UsIHVkaWQ6IGRldmljZS51ZGlkfTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0U2ltICgpIHtcbiAgICBjb25zdCBydW5PcHRzID0ge1xuICAgICAgc2NhbGVGYWN0b3I6IHRoaXMub3B0cy5zY2FsZUZhY3RvcixcbiAgICAgIGNvbm5lY3RIYXJkd2FyZUtleWJvYXJkOiAhIXRoaXMub3B0cy5jb25uZWN0SGFyZHdhcmVLZXlib2FyZCxcbiAgICAgIGlzSGVhZGxlc3M6ICEhdGhpcy5vcHRzLmlzSGVhZGxlc3MsXG4gICAgICBkZXZpY2VQcmVmZXJlbmNlczoge30sXG4gICAgfTtcblxuICAgIC8vIGFkZCB0aGUgd2luZG93IGNlbnRlciwgaWYgaXQgaXMgc3BlY2lmaWVkXG4gICAgaWYgKHRoaXMub3B0cy5TaW11bGF0b3JXaW5kb3dDZW50ZXIpIHtcbiAgICAgIHJ1bk9wdHMuZGV2aWNlUHJlZmVyZW5jZXMuU2ltdWxhdG9yV2luZG93Q2VudGVyID0gdGhpcy5vcHRzLlNpbXVsYXRvcldpbmRvd0NlbnRlcjtcbiAgICB9XG5cbiAgICAvLyBUaGlzIGlzIHRvIHdvcmthcm91bmQgWENUZXN0IGJ1ZyBhYm91dCBjaGFuZ2luZyBTaW11bGF0b3JcbiAgICAvLyBvcmllbnRhdGlvbiBpcyBub3Qgc3luY2hyb25pemVkIHRvIHRoZSBhY3R1YWwgd2luZG93IG9yaWVudGF0aW9uXG4gICAgY29uc3Qgb3JpZW50YXRpb24gPSBfLmlzU3RyaW5nKHRoaXMub3B0cy5vcmllbnRhdGlvbikgJiYgdGhpcy5vcHRzLm9yaWVudGF0aW9uLnRvVXBwZXJDYXNlKCk7XG4gICAgc3dpdGNoIChvcmllbnRhdGlvbikge1xuICAgICAgY2FzZSAnTEFORFNDQVBFJzpcbiAgICAgICAgcnVuT3B0cy5kZXZpY2VQcmVmZXJlbmNlcy5TaW11bGF0b3JXaW5kb3dPcmllbnRhdGlvbiA9ICdMYW5kc2NhcGVMZWZ0JztcbiAgICAgICAgcnVuT3B0cy5kZXZpY2VQcmVmZXJlbmNlcy5TaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlID0gOTA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnUE9SVFJBSVQnOlxuICAgICAgICBydW5PcHRzLmRldmljZVByZWZlcmVuY2VzLlNpbXVsYXRvcldpbmRvd09yaWVudGF0aW9uID0gJ1BvcnRyYWl0JztcbiAgICAgICAgcnVuT3B0cy5kZXZpY2VQcmVmZXJlbmNlcy5TaW11bGF0b3JXaW5kb3dSb3RhdGlvbkFuZ2xlID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5vcHRzLmRldmljZS5ydW4ocnVuT3B0cyk7XG4gIH1cblxuICBhc3luYyBjcmVhdGVTaW0gKCkge1xuICAgIHRoaXMubGlmZWN5Y2xlRGF0YS5jcmVhdGVTaW0gPSB0cnVlO1xuXG4gICAgLy8gR2V0IHBsYXRmb3JtIG5hbWUgZnJvbSBjb25zdCBzaW5jZSBpdCBtdXN0IGJlIGNhc2Ugc2Vuc2l0aXZlIHRvIGNyZWF0ZSBhIG5ldyBzaW11bGF0b3JcbiAgICBjb25zdCBwbGF0Zm9ybU5hbWUgPSBpc1R2T1ModGhpcy5vcHRzLnBsYXRmb3JtTmFtZSkgPyBQTEFURk9STV9OQU1FX1RWT1MgOiBQTEFURk9STV9OQU1FX0lPUztcblxuICAgIC8vIGNyZWF0ZSBzaW0gZm9yIGNhcHNcbiAgICBsZXQgc2ltID0gYXdhaXQgY3JlYXRlU2ltKHRoaXMub3B0cywgcGxhdGZvcm1OYW1lKTtcbiAgICBsb2cuaW5mbyhgQ3JlYXRlZCBzaW11bGF0b3Igd2l0aCB1ZGlkICcke3NpbS51ZGlkfScuYCk7XG5cbiAgICByZXR1cm4gc2ltO1xuICB9XG5cbiAgYXN5bmMgbGF1bmNoQXBwICgpIHtcbiAgICBjb25zdCBBUFBfTEFVTkNIX1RJTUVPVVQgPSAyMCAqIDEwMDA7XG5cbiAgICB0aGlzLmxvZ0V2ZW50KCdhcHBMYXVuY2hBdHRlbXB0ZWQnKTtcbiAgICBhd2FpdCBsYXVuY2godGhpcy5vcHRzLmRldmljZS51ZGlkLCB0aGlzLm9wdHMuYnVuZGxlSWQpO1xuXG4gICAgbGV0IGNoZWNrU3RhdHVzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9zdGF0dXMnLCAnR0VUJyk7XG4gICAgICBsZXQgY3VycmVudEFwcCA9IHJlc3BvbnNlLmN1cnJlbnRBcHAuYnVuZGxlSUQ7XG4gICAgICBpZiAoY3VycmVudEFwcCAhPT0gdGhpcy5vcHRzLmJ1bmRsZUlkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHt0aGlzLm9wdHMuYnVuZGxlSWR9IG5vdCBpbiBmb3JlZ3JvdW5kLiAke2N1cnJlbnRBcHB9IGlzIGluIGZvcmVncm91bmRgKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgbG9nLmluZm8oYFdhaXRpbmcgZm9yICcke3RoaXMub3B0cy5idW5kbGVJZH0nIHRvIGJlIGluIGZvcmVncm91bmRgKTtcbiAgICBsZXQgcmV0cmllcyA9IHBhcnNlSW50KEFQUF9MQVVOQ0hfVElNRU9VVCAvIDIwMCwgMTApO1xuICAgIGF3YWl0IHJldHJ5SW50ZXJ2YWwocmV0cmllcywgMjAwLCBjaGVja1N0YXR1cyk7XG4gICAgbG9nLmluZm8oYCR7dGhpcy5vcHRzLmJ1bmRsZUlkfSBpcyBpbiBmb3JlZ3JvdW5kYCk7XG4gICAgdGhpcy5sb2dFdmVudCgnYXBwTGF1bmNoZWQnKTtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0V2RhU2Vzc2lvbiAoYnVuZGxlSWQsIHByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICBsZXQgYXJncyA9IHByb2Nlc3NBcmd1bWVudHMgPyAocHJvY2Vzc0FyZ3VtZW50cy5hcmdzIHx8IFtdKSA6IFtdO1xuICAgIGlmICghXy5pc0FycmF5KGFyZ3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHByb2Nlc3NBcmd1bWVudHMuYXJncyBjYXBhYmlsaXR5IGlzIGV4cGVjdGVkIHRvIGJlIGFuIGFycmF5LiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJHtKU09OLnN0cmluZ2lmeShhcmdzKX0gaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICAgIH1cbiAgICBsZXQgZW52ID0gcHJvY2Vzc0FyZ3VtZW50cyA/IChwcm9jZXNzQXJndW1lbnRzLmVudiB8fCB7fSkgOiB7fTtcbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChlbnYpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHByb2Nlc3NBcmd1bWVudHMuZW52IGNhcGFiaWxpdHkgaXMgZXhwZWN0ZWQgdG8gYmUgYSBkaWN0aW9uYXJ5LiBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgJHtKU09OLnN0cmluZ2lmeShlbnYpfSBpcyBnaXZlbiBpbnN0ZWFkYCk7XG4gICAgfVxuXG4gICAgbGV0IHNob3VsZFdhaXRGb3JRdWllc2NlbmNlID0gdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMud2FpdEZvclF1aWVzY2VuY2UpID8gdGhpcy5vcHRzLndhaXRGb3JRdWllc2NlbmNlIDogdHJ1ZTtcbiAgICBsZXQgbWF4VHlwaW5nRnJlcXVlbmN5ID0gdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMubWF4VHlwaW5nRnJlcXVlbmN5KSA/IHRoaXMub3B0cy5tYXhUeXBpbmdGcmVxdWVuY3kgOiA2MDtcbiAgICBsZXQgc2hvdWxkVXNlU2luZ2xldG9uVGVzdE1hbmFnZXIgPSB1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zaG91bGRVc2VTaW5nbGV0b25UZXN0TWFuYWdlcikgPyB0aGlzLm9wdHMuc2hvdWxkVXNlU2luZ2xldG9uVGVzdE1hbmFnZXIgOiB0cnVlO1xuICAgIGxldCBzaG91bGRVc2VUZXN0TWFuYWdlckZvclZpc2liaWxpdHlEZXRlY3Rpb24gPSBmYWxzZTtcbiAgICBsZXQgZXZlbnRsb29wSWRsZURlbGF5U2VjID0gdGhpcy5vcHRzLndkYUV2ZW50bG9vcElkbGVEZWxheSB8fCAwO1xuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5zaW1wbGVJc1Zpc2libGVDaGVjaykpIHtcbiAgICAgIHNob3VsZFVzZVRlc3RNYW5hZ2VyRm9yVmlzaWJpbGl0eURldGVjdGlvbiA9IHRoaXMub3B0cy5zaW1wbGVJc1Zpc2libGVDaGVjaztcbiAgICB9XG4gICAgaWYgKHV0aWwuY29tcGFyZVZlcnNpb25zKHRoaXMub3B0cy5wbGF0Zm9ybVZlcnNpb24sICc9PScsICc5LjMnKSkge1xuICAgICAgbG9nLmluZm8oYEZvcmNpbmcgc2hvdWxkVXNlU2luZ2xldG9uVGVzdE1hbmFnZXIgY2FwYWJpbGl0eSB2YWx1ZSB0byB0cnVlLCBiZWNhdXNlIG9mIGtub3duIFhDVGVzdCBpc3N1ZXMgdW5kZXIgOS4zIHBsYXRmb3JtIHZlcnNpb25gKTtcbiAgICAgIHNob3VsZFVzZVRlc3RNYW5hZ2VyRm9yVmlzaWJpbGl0eURldGVjdGlvbiA9IHRydWU7XG4gICAgfVxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5sYW5ndWFnZSkpIHtcbiAgICAgIGFyZ3MucHVzaCgnLUFwcGxlTGFuZ3VhZ2VzJywgYCgke3RoaXMub3B0cy5sYW5ndWFnZX0pYCk7XG4gICAgICBhcmdzLnB1c2goJy1OU0xhbmd1YWdlcycsIGAoJHt0aGlzLm9wdHMubGFuZ3VhZ2V9KWApO1xuICAgIH1cblxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5sb2NhbGUpKSB7XG4gICAgICBhcmdzLnB1c2goJy1BcHBsZUxvY2FsZScsIHRoaXMub3B0cy5sb2NhbGUpO1xuICAgIH1cblxuICAgIGxldCBkZXNpcmVkID0ge1xuICAgICAgZGVzaXJlZENhcGFiaWxpdGllczoge1xuICAgICAgICBidW5kbGVJZCxcbiAgICAgICAgYXJndW1lbnRzOiBhcmdzLFxuICAgICAgICBlbnZpcm9ubWVudDogZW52LFxuICAgICAgICBldmVudGxvb3BJZGxlRGVsYXlTZWMsXG4gICAgICAgIHNob3VsZFdhaXRGb3JRdWllc2NlbmNlLFxuICAgICAgICBzaG91bGRVc2VUZXN0TWFuYWdlckZvclZpc2liaWxpdHlEZXRlY3Rpb24sXG4gICAgICAgIG1heFR5cGluZ0ZyZXF1ZW5jeSxcbiAgICAgICAgc2hvdWxkVXNlU2luZ2xldG9uVGVzdE1hbmFnZXIsXG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAodXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMuc2hvdWxkVXNlQ29tcGFjdFJlc3BvbnNlcykpIHtcbiAgICAgIGRlc2lyZWQuZGVzaXJlZENhcGFiaWxpdGllcy5zaG91bGRVc2VDb21wYWN0UmVzcG9uc2VzID0gdGhpcy5vcHRzLnNob3VsZFVzZUNvbXBhY3RSZXNwb25zZXM7XG4gICAgfVxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5lbGVtZW50UmVzcG9uc2VGaWVsZHMpKSB7XG4gICAgICBkZXNpcmVkLmRlc2lyZWRDYXBhYmlsaXRpZXMuZWxlbWVudFJlc3BvbnNlRmllbGRzID0gdGhpcy5vcHRzLmVsZW1lbnRSZXNwb25zZUZpZWxkcztcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0cy5hdXRvQWNjZXB0QWxlcnRzKSB7XG4gICAgICBkZXNpcmVkLmRlc2lyZWRDYXBhYmlsaXRpZXMuZGVmYXVsdEFsZXJ0QWN0aW9uID0gJ2FjY2VwdCc7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdHMuYXV0b0Rpc21pc3NBbGVydHMpIHtcbiAgICAgIGRlc2lyZWQuZGVzaXJlZENhcGFiaWxpdGllcy5kZWZhdWx0QWxlcnRBY3Rpb24gPSAnZGlzbWlzcyc7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9zZXNzaW9uJywgJ1BPU1QnLCBkZXNpcmVkKTtcbiAgfVxuXG4gIC8vIE92ZXJyaWRlIFByb3h5IG1ldGhvZHMgZnJvbSBCYXNlRHJpdmVyXG4gIHByb3h5QWN0aXZlICgpIHtcbiAgICByZXR1cm4gdGhpcy5qd3BQcm94eUFjdGl2ZTtcbiAgfVxuXG4gIGdldFByb3h5QXZvaWRMaXN0ICgpIHtcbiAgICBpZiAodGhpcy5pc1dlYnZpZXcoKSkge1xuICAgICAgcmV0dXJuIE5PX1BST1hZX1dFQl9MSVNUO1xuICAgIH1cbiAgICByZXR1cm4gTk9fUFJPWFlfTkFUSVZFX0xJU1Q7XG4gIH1cblxuICBjYW5Qcm94eSAoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpc1NhZmFyaSAoKSB7XG4gICAgcmV0dXJuICEhdGhpcy5zYWZhcmk7XG4gIH1cblxuICBpc1JlYWxEZXZpY2UgKCkge1xuICAgIHJldHVybiB0aGlzLm9wdHMucmVhbERldmljZTtcbiAgfVxuXG4gIGlzU2ltdWxhdG9yICgpIHtcbiAgICByZXR1cm4gIXRoaXMub3B0cy5yZWFsRGV2aWNlO1xuICB9XG5cbiAgaXNXZWJ2aWV3ICgpIHtcbiAgICByZXR1cm4gdGhpcy5pc1NhZmFyaSgpIHx8IHRoaXMuaXNXZWJDb250ZXh0KCk7XG4gIH1cblxuICB2YWxpZGF0ZUxvY2F0b3JTdHJhdGVneSAoc3RyYXRlZ3kpIHtcbiAgICBzdXBlci52YWxpZGF0ZUxvY2F0b3JTdHJhdGVneShzdHJhdGVneSwgdGhpcy5pc1dlYkNvbnRleHQoKSk7XG4gIH1cblxuICB2YWxpZGF0ZURlc2lyZWRDYXBzIChjYXBzKSB7XG4gICAgaWYgKCFzdXBlci52YWxpZGF0ZURlc2lyZWRDYXBzKGNhcHMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIGNhcGFiaWxpdGllcyBoYXZlIG9uZSBvZiBgYXBwYCBvciBgYnVuZGxlSWRgXG4gICAgaWYgKChjYXBzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJyAmJiAhY2Fwcy5hcHAgJiYgIWNhcHMuYnVuZGxlSWQpIHtcbiAgICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwIG9yIGEgYnVuZGxlSWQgZm9yIGlPUyc7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cblxuICAgIGlmICghdXRpbC5jb2VyY2VWZXJzaW9uKGNhcHMucGxhdGZvcm1WZXJzaW9uLCBmYWxzZSkpIHtcbiAgICAgIGxvZy53YXJuKGAncGxhdGZvcm1WZXJzaW9uJyBjYXBhYmlsaXR5ICgnJHtjYXBzLnBsYXRmb3JtVmVyc2lvbn0nKSBpcyBub3QgYSB2YWxpZCB2ZXJzaW9uIG51bWJlci4gYCArXG4gICAgICAgIGBDb25zaWRlciBmaXhpbmcgaXQgb3IgYmUgcmVhZHkgdG8gZXhwZXJpZW5jZSBhbiBpbmNvbnNpc3RlbnQgZHJpdmVyIGJlaGF2aW9yLmApO1xuICAgIH1cblxuICAgIGxldCB2ZXJpZnlQcm9jZXNzQXJndW1lbnQgPSAocHJvY2Vzc0FyZ3VtZW50cykgPT4ge1xuICAgICAgY29uc3Qge2FyZ3MsIGVudn0gPSBwcm9jZXNzQXJndW1lbnRzO1xuICAgICAgaWYgKCFfLmlzTmlsKGFyZ3MpICYmICFfLmlzQXJyYXkoYXJncykpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coJ3Byb2Nlc3NBcmd1bWVudHMuYXJncyBtdXN0IGJlIGFuIGFycmF5IG9mIHN0cmluZ3MnKTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc05pbChlbnYpICYmICFfLmlzUGxhaW5PYmplY3QoZW52KSkge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdygncHJvY2Vzc0FyZ3VtZW50cy5lbnYgbXVzdCBiZSBhbiBvYmplY3QgPGtleSx2YWx1ZT4gcGFpciB7YTpiLCBjOmR9Jyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIGBwcm9jZXNzQXJndW1lbnRzYCBzaG91bGQgYmUgSlNPTiBzdHJpbmcgb3IgYW4gb2JqZWN0IHdpdGggYXJndW1lbnRzIGFuZC8gZW52aXJvbm1lbnQgZGV0YWlsc1xuICAgIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgICAgY2Fwcy5wcm9jZXNzQXJndW1lbnRzID0gSlNPTi5wYXJzZShjYXBzLnByb2Nlc3NBcmd1bWVudHMpO1xuICAgICAgICAgIHZlcmlmeVByb2Nlc3NBcmd1bWVudChjYXBzLnByb2Nlc3NBcmd1bWVudHMpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgcHJvY2Vzc0FyZ3VtZW50cyBtdXN0IGJlIGEganNvbiBmb3JtYXQgb3IgYW4gb2JqZWN0IHdpdGggZm9ybWF0IHthcmdzIDogW10sIGVudiA6IHthOmIsIGM6ZH19LiBgICtcbiAgICAgICAgICAgIGBCb3RoIGVudmlyb25tZW50IGFuZCBhcmd1bWVudCBjYW4gYmUgbnVsbC4gRXJyb3I6ICR7ZXJyfWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICAgIHZlcmlmeVByb2Nlc3NBcmd1bWVudChjYXBzLnByb2Nlc3NBcmd1bWVudHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYW4gb2JqZWN0LCBvciBhIHN0cmluZyBKU09OIG9iamVjdCB3aXRoIGZvcm1hdCB7YXJncyA6IFtdLCBlbnYgOiB7YTpiLCBjOmR9fS4gYCArXG4gICAgICAgICAgYEJvdGggZW52aXJvbm1lbnQgYW5kIGFyZ3VtZW50IGNhbiBiZSBudWxsLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHRoZXJlIGlzIG5vIHBvaW50IGluIGhhdmluZyBga2V5Y2hhaW5QYXRoYCB3aXRob3V0IGBrZXljaGFpblBhc3N3b3JkYFxuICAgIGlmICgoY2Fwcy5rZXljaGFpblBhdGggJiYgIWNhcHMua2V5Y2hhaW5QYXNzd29yZCkgfHwgKCFjYXBzLmtleWNoYWluUGF0aCAmJiBjYXBzLmtleWNoYWluUGFzc3dvcmQpKSB7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgSWYgJ2tleWNoYWluUGF0aCcgaXMgc2V0LCAna2V5Y2hhaW5QYXNzd29yZCcgbXVzdCBhbHNvIGJlIHNldCAoYW5kIHZpY2UgdmVyc2EpLmApO1xuICAgIH1cblxuICAgIC8vIGByZXNldE9uU2Vzc2lvblN0YXJ0T25seWAgc2hvdWxkIGJlIHNldCB0byB0cnVlIGJ5IGRlZmF1bHRcbiAgICB0aGlzLm9wdHMucmVzZXRPblNlc3Npb25TdGFydE9ubHkgPSAhdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMucmVzZXRPblNlc3Npb25TdGFydE9ubHkpIHx8IHRoaXMub3B0cy5yZXNldE9uU2Vzc2lvblN0YXJ0T25seTtcbiAgICB0aGlzLm9wdHMudXNlTmV3V0RBID0gdXRpbC5oYXNWYWx1ZSh0aGlzLm9wdHMudXNlTmV3V0RBKSA/IHRoaXMub3B0cy51c2VOZXdXREEgOiBmYWxzZTtcblxuICAgIGlmIChjYXBzLmNvbW1hbmRUaW1lb3V0cykge1xuICAgICAgY2Fwcy5jb21tYW5kVGltZW91dHMgPSBub3JtYWxpemVDb21tYW5kVGltZW91dHMoY2Fwcy5jb21tYW5kVGltZW91dHMpO1xuICAgIH1cblxuICAgIGlmIChfLmlzU3RyaW5nKGNhcHMud2ViRHJpdmVyQWdlbnRVcmwpKSB7XG4gICAgICBjb25zdCB7cHJvdG9jb2wsIGhvc3R9ID0gdXJsLnBhcnNlKGNhcHMud2ViRHJpdmVyQWdlbnRVcmwpO1xuICAgICAgaWYgKF8uaXNFbXB0eShwcm90b2NvbCkgfHwgXy5pc0VtcHR5KGhvc3QpKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGAnd2ViRHJpdmVyQWdlbnRVcmwnIGNhcGFiaWxpdHkgaXMgZXhwZWN0ZWQgdG8gY29udGFpbiBhIHZhbGlkIFdlYkRyaXZlckFnZW50IHNlcnZlciBVUkwuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgJyR7Y2Fwcy53ZWJEcml2ZXJBZ2VudFVybH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2Fwcy5icm93c2VyTmFtZSkge1xuICAgICAgaWYgKGNhcHMuYnVuZGxlSWQpIHtcbiAgICAgICAgbG9nLmVycm9yQW5kVGhyb3coYCdicm93c2VyTmFtZScgY2Fubm90IGJlIHNldCB0b2dldGhlciB3aXRoICdidW5kbGVJZCcgY2FwYWJpbGl0eWApO1xuICAgICAgfVxuICAgICAgLy8gd2FybiBpZiB0aGUgY2FwYWJpbGl0aWVzIGhhdmUgYm90aCBgYXBwYCBhbmQgYGJyb3dzZXIsIGFsdGhvdWdoIHRoaXNcbiAgICAgIC8vIGlzIGNvbW1vbiB3aXRoIHNlbGVuaXVtIGdyaWRcbiAgICAgIGlmIChjYXBzLmFwcCkge1xuICAgICAgICBsb2cud2FybihgVGhlIGNhcGFiaWxpdGllcyBzaG91bGQgZ2VuZXJhbGx5IG5vdCBpbmNsdWRlIGJvdGggYW4gJ2FwcCcgYW5kIGEgJ2Jyb3dzZXJOYW1lJ2ApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjYXBzLnBlcm1pc3Npb25zKSB7XG4gICAgICB0cnkge1xuICAgICAgICBmb3IgKGNvbnN0IFtidW5kbGVJZCwgcGVybXNdIG9mIF8udG9QYWlycyhKU09OLnBhcnNlKGNhcHMucGVybWlzc2lvbnMpKSkge1xuICAgICAgICAgIGlmICghXy5pc1N0cmluZyhidW5kbGVJZCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7SlNPTi5zdHJpbmdpZnkoYnVuZGxlSWQpfScgbXVzdCBiZSBhIHN0cmluZ2ApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChwZXJtcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7SlNPTi5zdHJpbmdpZnkocGVybXMpfScgbXVzdCBiZSBhIEpTT04gb2JqZWN0YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGAnJHtjYXBzLnBlcm1pc3Npb25zfScgaXMgZXhwZWN0ZWQgdG8gYmUgYSB2YWxpZCBvYmplY3Qgd2l0aCBmb3JtYXQgYCArXG4gICAgICAgICAgYHtcIjxidW5kbGVJZDE+XCI6IHtcIjxzZXJ2aWNlTmFtZTE+XCI6IFwiPHNlcnZpY2VTdGF0dXMxPlwiLCAuLi59LCAuLi59LiBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNhcHMucGxhdGZvcm1WZXJzaW9uICYmICF1dGlsLmNvZXJjZVZlcnNpb24oY2Fwcy5wbGF0Zm9ybVZlcnNpb24sIGZhbHNlKSkge1xuICAgICAgbG9nLmVycm9yQW5kVGhyb3coYCdwbGF0Zm9ybVZlcnNpb24nIG11c3QgYmUgYSB2YWxpZCB2ZXJzaW9uIG51bWJlci4gYCArXG4gICAgICAgIGAnJHtjYXBzLnBsYXRmb3JtVmVyc2lvbn0nIGlzIGdpdmVuIGluc3RlYWQuYCk7XG4gICAgfVxuXG4gICAgLy8gZmluYWxseSwgcmV0dXJuIHRydWUgc2luY2UgdGhlIHN1cGVyY2xhc3MgY2hlY2sgcGFzc2VkLCBhcyBkaWQgdGhpc1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgYXN5bmMgaW5zdGFsbEFVVCAoKSB7XG4gICAgaWYgKHRoaXMuaXNTYWZhcmkoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvLyBpZiB1c2VyIGhhcyBwYXNzZWQgaW4gZGVzaXJlZENhcHMuYXV0b0xhdW5jaCA9IGZhbHNlXG4gICAgLy8gbWVhbmluZyB0aGV5IHdpbGwgbWFuYWdlIGFwcCBpbnN0YWxsIC8gbGF1bmNoaW5nXG4gICAgaWYgKHRoaXMub3B0cy5hdXRvTGF1bmNoID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCB2ZXJpZnlBcHBsaWNhdGlvblBsYXRmb3JtKHRoaXMub3B0cy5hcHAsIHRoaXMuaXNTaW11bGF0b3IoKSwgaXNUdk9TKHRoaXMub3B0cy5wbGF0Zm9ybU5hbWUpKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIFRPRE86IExldCBpdCB0aHJvdyBhZnRlciB3ZSBjb25maXJtIHRoZSBhcmNoaXRlY3R1cmUgdmVyaWZpY2F0aW9uIGFsZ29yaXRobSBpcyBzdGFibGVcbiAgICAgIGxvZy53YXJuKGAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipgKTtcbiAgICAgIGxvZy53YXJuKGAke3RoaXMuaXNTaW11bGF0b3IoKSA/ICdTaW11bGF0b3InIDogJ1JlYWwgZGV2aWNlJ30gYXJjaGl0ZWN0dXJlIGFwcGVhcnMgdG8gYmUgdW5zdXBwb3J0ZWQgYCArXG4gICAgICAgICAgICAgICBgYnkgdGhlICcke3RoaXMub3B0cy5hcHB9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgICAgICAgICBgTWFrZSBzdXJlIHRoZSBjb3JyZWN0IGRlcGxveW1lbnQgdGFyZ2V0IGhhcyBiZWVuIHNlbGVjdGVkIGZvciBpdHMgY29tcGlsYXRpb24gaW4gWGNvZGUuYCk7XG4gICAgICBsb2cud2FybignRG9uXFwndCBiZSBzdXJwcmlzZWQgaWYgdGhlIGFwcGxpY2F0aW9uIGZhaWxzIHRvIGxhdW5jaC4nKTtcbiAgICAgIGxvZy53YXJuKGAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipgKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc1JlYWxEZXZpY2UoKSkge1xuICAgICAgYXdhaXQgaW5zdGFsbFRvUmVhbERldmljZSh0aGlzLm9wdHMuZGV2aWNlLCB0aGlzLm9wdHMuYXBwLCB0aGlzLm9wdHMuYnVuZGxlSWQsIHRoaXMub3B0cy5ub1Jlc2V0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXdhaXQgaW5zdGFsbFRvU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UsIHRoaXMub3B0cy5hcHAsIHRoaXMub3B0cy5idW5kbGVJZCwgdGhpcy5vcHRzLm5vUmVzZXQpO1xuICAgIH1cblxuICAgIGlmICh1dGlsLmhhc1ZhbHVlKHRoaXMub3B0cy5pb3NJbnN0YWxsUGF1c2UpKSB7XG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvNjg4OVxuICAgICAgbGV0IHBhdXNlID0gcGFyc2VJbnQodGhpcy5vcHRzLmlvc0luc3RhbGxQYXVzZSwgMTApO1xuICAgICAgbG9nLmRlYnVnKGBpb3NJbnN0YWxsUGF1c2Ugc2V0LiBQYXVzaW5nICR7cGF1c2V9IG1zIGJlZm9yZSBjb250aW51aW5nYCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KHBhdXNlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZXRJbml0aWFsT3JpZW50YXRpb24gKG9yaWVudGF0aW9uKSB7XG4gICAgaWYgKCFfLmlzU3RyaW5nKG9yaWVudGF0aW9uKSkge1xuICAgICAgbG9nLmluZm8oJ1NraXBwaW5nIHNldHRpbmcgb2YgdGhlIGluaXRpYWwgZGlzcGxheSBvcmllbnRhdGlvbi4gJyArXG4gICAgICAgICdTZXQgdGhlIFwib3JpZW50YXRpb25cIiBjYXBhYmlsaXR5IHRvIGVpdGhlciBcIkxBTkRTQ0FQRVwiIG9yIFwiUE9SVFJBSVRcIiwgaWYgdGhpcyBpcyBhbiB1bmRlc2lyZWQgYmVoYXZpb3IuJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIG9yaWVudGF0aW9uID0gb3JpZW50YXRpb24udG9VcHBlckNhc2UoKTtcbiAgICBpZiAoIV8uaW5jbHVkZXMoWydMQU5EU0NBUEUnLCAnUE9SVFJBSVQnXSwgb3JpZW50YXRpb24pKSB7XG4gICAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBzZXQgaW5pdGlhbCBvcmllbnRhdGlvbiB0byAnJHtvcmllbnRhdGlvbn0nYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBpbml0aWFsIG9yaWVudGF0aW9uIHRvICcke29yaWVudGF0aW9ufSdgKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy9vcmllbnRhdGlvbicsICdQT1NUJywge29yaWVudGF0aW9ufSk7XG4gICAgICB0aGlzLm9wdHMuY3VyT3JpZW50YXRpb24gPSBvcmllbnRhdGlvbjtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBTZXR0aW5nIGluaXRpYWwgb3JpZW50YXRpb24gZmFpbGVkIHdpdGg6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgX2dldENvbW1hbmRUaW1lb3V0IChjbWROYW1lKSB7XG4gICAgaWYgKHRoaXMub3B0cy5jb21tYW5kVGltZW91dHMpIHtcbiAgICAgIGlmIChjbWROYW1lICYmIF8uaGFzKHRoaXMub3B0cy5jb21tYW5kVGltZW91dHMsIGNtZE5hbWUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9wdHMuY29tbWFuZFRpbWVvdXRzW2NtZE5hbWVdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMub3B0cy5jb21tYW5kVGltZW91dHNbREVGQVVMVF9USU1FT1VUX0tFWV07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXNzaW9uIGNhcGFiaWxpdGllcyBtZXJnZWQgd2l0aCB3aGF0IFdEQSByZXBvcnRzXG4gICAqIFRoaXMgaXMgYSBsaWJyYXJ5IGNvbW1hbmQgYnV0IG5lZWRzIHRvIGNhbGwgJ3N1cGVyJyBzbyBjYW4ndCBiZSBvblxuICAgKiBhIGhlbHBlciBvYmplY3RcbiAgICovXG4gIGFzeW5jIGdldFNlc3Npb24gKCkge1xuICAgIC8vIGNhbGwgc3VwZXIgdG8gZ2V0IGV2ZW50IHRpbWluZ3MsIGV0Yy4uLlxuICAgIGNvbnN0IGRyaXZlclNlc3Npb24gPSBhd2FpdCBzdXBlci5nZXRTZXNzaW9uKCk7XG4gICAgaWYgKCF0aGlzLndkYUNhcHMpIHtcbiAgICAgIHRoaXMud2RhQ2FwcyA9IGF3YWl0IHRoaXMucHJveHlDb21tYW5kKCcvJywgJ0dFVCcpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuZGV2aWNlQ2Fwcykge1xuICAgICAgY29uc3Qge3N0YXR1c0JhclNpemUsIHNjYWxlfSA9IGF3YWl0IHRoaXMuZ2V0U2NyZWVuSW5mbygpO1xuICAgICAgdGhpcy5kZXZpY2VDYXBzID0ge1xuICAgICAgICBwaXhlbFJhdGlvOiBzY2FsZSxcbiAgICAgICAgc3RhdEJhckhlaWdodDogc3RhdHVzQmFyU2l6ZS5oZWlnaHQsXG4gICAgICAgIHZpZXdwb3J0UmVjdDogYXdhaXQgdGhpcy5nZXRWaWV3cG9ydFJlY3QoKSxcbiAgICAgIH07XG4gICAgfVxuICAgIGxvZy5pbmZvKCdNZXJnaW5nIFdEQSBjYXBzIG92ZXIgQXBwaXVtIGNhcHMgZm9yIHNlc3Npb24gZGV0YWlsIHJlc3BvbnNlJyk7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe3VkaWQ6IHRoaXMub3B0cy51ZGlkfSwgZHJpdmVyU2Vzc2lvbixcbiAgICAgIHRoaXMud2RhQ2Fwcy5jYXBhYmlsaXRpZXMsIHRoaXMuZGV2aWNlQ2Fwcyk7XG4gIH1cblxuICBhc3luYyBzdGFydElXRFAgKCkge1xuICAgIHRoaXMubG9nRXZlbnQoJ2l3ZHBTdGFydGluZycpO1xuICAgIHRoaXMuaXdkcFNlcnZlciA9IG5ldyBJV0RQKHtcbiAgICAgIHdlYmtpdERlYnVnUHJveHlQb3J0OiB0aGlzLm9wdHMud2Via2l0RGVidWdQcm94eVBvcnQsXG4gICAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZCxcbiAgICAgIGxvZ1N0ZG91dDogISF0aGlzLm9wdHMuc2hvd0lXRFBMb2csXG4gICAgfSk7XG4gICAgYXdhaXQgdGhpcy5pd2RwU2VydmVyLnN0YXJ0KCk7XG4gICAgdGhpcy5sb2dFdmVudCgnaXdkcFN0YXJ0ZWQnKTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BJV0RQICgpIHtcbiAgICBpZiAodGhpcy5pd2RwU2VydmVyKSB7XG4gICAgICBhd2FpdCB0aGlzLml3ZHBTZXJ2ZXIuc3RvcCgpO1xuICAgICAgZGVsZXRlIHRoaXMuaXdkcFNlcnZlcjtcbiAgICB9XG4gIH1cblxuICBhc3luYyByZXNldCAoKSB7XG4gICAgaWYgKHRoaXMub3B0cy5ub1Jlc2V0KSB7XG4gICAgICAvLyBUaGlzIGlzIHRvIG1ha2Ugc3VyZSByZXNldCBoYXBwZW5zIGV2ZW4gaWYgbm9SZXNldCBpcyBzZXQgdG8gdHJ1ZVxuICAgICAgbGV0IG9wdHMgPSBfLmNsb25lRGVlcCh0aGlzLm9wdHMpO1xuICAgICAgb3B0cy5ub1Jlc2V0ID0gZmFsc2U7XG4gICAgICBvcHRzLmZ1bGxSZXNldCA9IGZhbHNlO1xuICAgICAgY29uc3Qgc2h1dGRvd25IYW5kbGVyID0gdGhpcy5yZXNldE9uVW5leHBlY3RlZFNodXRkb3duO1xuICAgICAgdGhpcy5yZXNldE9uVW5leHBlY3RlZFNodXRkb3duID0gKCkgPT4ge307XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnJ1blJlc2V0KG9wdHMpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgdGhpcy5yZXNldE9uVW5leHBlY3RlZFNodXRkb3duID0gc2h1dGRvd25IYW5kbGVyO1xuICAgICAgfVxuICAgIH1cbiAgICBhd2FpdCBzdXBlci5yZXNldCgpO1xuICB9XG59XG5cbk9iamVjdC5hc3NpZ24oWENVSVRlc3REcml2ZXIucHJvdG90eXBlLCBjb21tYW5kcyk7XG5cbmV4cG9ydCBkZWZhdWx0IFhDVUlUZXN0RHJpdmVyO1xuZXhwb3J0IHsgWENVSVRlc3REcml2ZXIgfTtcbiJdLCJmaWxlIjoibGliL2RyaXZlci5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
